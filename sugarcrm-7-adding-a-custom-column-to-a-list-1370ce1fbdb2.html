<!DOCTYPE html>
<html lang="en">
<head>
        <title>SugarCRM 7 — Adding a custom column to a list</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/pure-min.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-min.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css" />
        <link rel="stylesheet" href="./theme/css/main.css" />
        <link rel="stylesheet" href="./theme/css/forms.css" />
        <link rel="stylesheet" href="./theme/fonts/fonts.css" />
        <link href="https://shanedowling.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Shane Dowling Full Atom Feed" />
        <link href="https://shanedowling.com/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="Shane Dowling Full RSS Feed" />
        <link href="https://shanedowling.com/feeds/category.slug.atom.xml" type="application/atom+xml" rel="alternate" title="Shane Dowling Categories Atom Feed" />
        <link href="https://shanedowling.com/feeds/category.slug.rss.xml" type="application/rss+xml" rel="alternate" title="Shane Dowling Categories RSS Feed" />
</head>
<body>

    <div class="main-nav-container">

        <div class="pure-g">
            <div class="pure-u-1 pure-u-lg-2-3">
                <div class="main-nav">
                    <ul class="main-nav-list">
                        <li class="main-nav-item"><a href="./" class="pure-menu-link">Shane Dowling</a></li>

                        <li class="main-nav-item"><a href="./category/til.html" class="pure-menu-link">TIL</a></li>
                        <li class="main-nav-item active"><a href="./category/tech.html" class="pure-menu-link">Tech</a></li>
                        <li class="main-nav-item"><a href="./category/random.html" class="pure-menu-link">Random</a></li>
                        <li class="main-nav-item"><a href="./category/productivity.html" class="pure-menu-link">Productivity</a></li>
                        <li class="main-nav-item"><a href="./category/mindfulness.html" class="pure-menu-link">Mindfulness</a></li>
                        <li class="main-nav-item"><a href="./category/leadership.html" class="pure-menu-link">Leadership</a></li>
                        <li class="main-nav-item"><a href="./category/digital-minimalism.html" class="pure-menu-link">Digital Minimalism</a></li>
                        <li class="main-nav-item"><a href="./pages/contact.html" class="pure-menu-link">Contact</a></li>
                    </ul>
                </div>
             </div>

             <div class="pure-u-1 pure-u-lg-1-3"></div>
        </div>

    </div>


<div class="page-container">
    <div class="entry-content">
        <div class="post-meta pure-g">
            <div class="pure-u-3-4 meta-data">
                <a href="./category/tech.html" class="category">Tech</a><br />

                <a class="author" href="./author/shane-dowling.html">Shane Dowling</a>
                &mdash; <abbr title="2014-05-22T00:00:00+00:00">Thu 22 May 2014</abbr>
            </div>
        </div>
    </div>

    <div class="article-header-container">
        <div class="background-image-container">

            <div class="background-image-small">
                <div class="title-container">
                    <h1>SugarCRM 7 — Adding a custom column to a list</h1>
                </div>
            </div>
        </div>
    </div>

    <div class="entry-content">
        <p>This is the SugarCRM 7 equivalent to this post <a href="https://shanedowling.com/sugarcrm-add-a-code-driven-column-to-a-list-4e9f4eb672b1">here</a>, because Sugar has dropped the process record logic hook, we need to come up with a new solution.</p>
<p>Here's how you can add a new column to a list view, I have to admit this
is one of the really powerful additions to SugarCRM 7, no more crazy
config files or hacks to try cheat your data in. By leveraging
javascript events with a decent restful API you can come up with some
really nice solutions, with lots of hooks to do custom things. Once you
see the difference in implementation you'll see why I'm so pleased.</p>
<p>So anyway, back to the customisations.</p>
<h3>1. Add the placeholder column</h3>
<p>You need to do this by adding a new column into your custom modules
list.php file, which is generally located at
custom/modules/YOUR_CUSTOM_MODULE/clients/base/views/list/list.php,
add your new column in under</p>
<div class="highlight"><pre><span></span><span class="x">$viewdefs[$modulename][&#39;base&#39;][&#39;view&#39;][&#39;list&#39;][&#39;panels&#39;][0][&#39;fields&#39;]</span>

<span class="x">array (</span>
<span class="x"> &#39;name&#39; =&gt; &#39;custom_fieldname&#39;,</span>
<span class="x"> &#39;label&#39; =&gt; &#39;LBL_CUSTOM_RECORD&#39;,</span>
<span class="x"> &#39;enabled&#39; =&gt; true,</span>
<span class="x"> &#39;width&#39; =&gt; &#39;10%&#39;,</span>
<span class="x"> &#39;default&#39; =&gt; true,</span>
<span class="x"> ),</span>
<span class="x"> ```</span>

<span class="x">### 2. Add the JS action</span>

<span class="x">This should go into</span>
<span class="x">custom/modules/YOUR_CUSTOM_MODULE/clients/base/views/recordlist/recordlist.js</span>
<span class="x">```javascript</span>
<span class="x">({</span>

<span class="x">this.before(&#39;render&#39;, function() {</span>
<span class="x"> return this.beforeRenderCallback()</span>
<span class="x"> }, this);</span>
<span class="x"> this.on(&#39;render&#39;, function() {</span>
<span class="x"> this.renderCallback();</span>
<span class="x"> if (this.previewVisible) {</span>
<span class="x"> this.decorateRow(this.previewModel);</span>
<span class="x"> }</span>
<span class="x"> }, this);</span>
<span class="x"> this._super(&quot;bindDataChange&quot;);</span>
<span class="x"> },</span>
<span class="x"> /**</span>
<span class="x"> * Callback for before on(&#39;render&#39;) event</span>
<span class="x"> */</span>
<span class="x"> this.collection.each(function(model) {</span>
<span class="x"> app.api.call(&#39;GET&#39;, app.api.buildURL(&#39;YOUR_CUSTOM_MODULE/YOUR_CUSTOM_FUNCTION/&#39;+model.id), null, {</span>
<span class="x"> model.set({</span>
<span class="x"> your_custom_field : data</span>
<span class="x"> });</span>
<span class="x"> }, this)</span>
<span class="x"> });</span>
<span class="x"> }, this);</span>
<span class="x"> },</span>
<span class="x"> })</span>
<span class="x"> ```</span>

<span class="x">### 3. Add the API end point</span>

<span class="x">The documentation here is really straightforward but as an example for</span>
<span class="x">completeness this should return a json response with the data needed.</span>

<span class="x">This code would go into</span>
<span class="x">custom/modules/YOUR_CUSTOM_MODULE/clients/base/api/YOUR_CUSTOM_FUNCTION.php</span>

<span class="x">```php</span>
<span class="x">if(!defined(&#39;sugarEntry&#39;) || !sugarEntry) die(&#39;Not A Valid Entry Point&#39;);</span>
<span class="x"> require_once(&#39;custom/modules/YOUR_CUSTOM_MODULE/Custom_Bean.php&#39;);</span>

<span class="x">class YOUR_CUSTOM_FUNCTION extends SugarApi</span>
<span class="x"> {</span>
<span class="x"> public function registerApiRest()</span>
<span class="x"> {</span>
<span class="x"> return array(</span>
<span class="x"> //GET</span>
<span class="x"> &#39;MyGetEndpoint&#39; =&gt; array(</span>
<span class="x"> //request type</span>
<span class="x"> &#39;reqType&#39; =&gt; &#39;GET&#39;,</span>

<span class="x">//endpoint path</span>
<span class="x"> &#39;path&#39; =&gt; array(&#39;YOUR_CUSTOM_MODULE&#39;, &#39;YOUR_CUSTOM_FUNCTION&#39;, &#39;?&#39;),</span>

<span class="x">//endpoint variables</span>
<span class="x"> &#39;pathVars&#39; =&gt; array(&#39;&#39;, &#39;&#39;, &#39;data&#39;),</span>

<span class="x">//method to call</span>
<span class="x"> &#39;method&#39; =&gt; &#39;MyGetMethod&#39;,</span>

<span class="x">//short help string to be displayed in the help documentation</span>
<span class="x"> &#39;shortHelp&#39; =&gt; &#39;Some help text&#39;,</span>

<span class="x">//long help to be displayed in the help documentation</span>
<span class="x"> //&#39;longHelp&#39; =&gt; &#39;&#39;,</span>
<span class="x"> ),</span>
<span class="x"> );</span>
<span class="x"> }</span>

<span class="x">/**</span>
<span class="x"> * Method to be used for my MyEndpoint/GetExample endpoint</span>
<span class="x"> */</span>
<span class="x"> public function MyGetMethod($api, $args)</span>
<span class="x"> {</span>
<span class="x"> $id = $args;</span>

<span class="x">$custom_bean = new Custom_Bean();</span>
<span class="x"> $custom_bean-&gt;retrieve($id);</span>

<span class="x">return $custom_bean-&gt;getCustomColumnData();</span>
<span class="x"> }</span>

<span class="x">}</span>
</pre></div>


<h3>4. Add to column to the dictionary</h3>
<p>custom/Extension/modules/YOUR_CUSTOM_MODULE/Ext/Vardefs/sugarfield_custom_fieldname.php</p>
<div class="highlight"><pre><span></span><span class="x">$dictionary[&#39;YOUR_CUSTOM_MODULE&#39;][&#39;fields&#39;][&#39;custom_fieldname&#39;][&#39;labelValue&#39;]=&#39;Custom Row &#39;;</span>
<span class="x"> $dictionary[&#39;YOUR_CUSTOM_MODULE&#39;][&#39;fields&#39;][&#39;custom_fieldname&#39;][&#39;full_text_search&#39;]=array (</span>
<span class="x"> &#39;boost&#39; =&gt; &#39;0&#39;,</span>
<span class="x"> &#39;enabled&#39; =&gt; false,</span>
<span class="x"> );</span>
<span class="x"> $dictionary[&#39;YOUR_CUSTOM_MODULE&#39;][&#39;fields&#39;][&#39;custom_fieldname&#39;][&#39;enforced&#39;]=&#39;&#39;;</span>
<span class="x"> $dictionary[&#39;YOUR_CUSTOM_MODULE&#39;][&#39;fields&#39;][&#39;custom_fieldname&#39;][&#39;dependency&#39;]=&#39;&#39;;</span>
<span class="x"> ?&gt;</span>
</pre></div>


<p>On quick repair/rebuild this will get merged into
custom/modules/YOUR_CUSTOM_MODULES/Ext/Vardefs/vardefs.ext.php</p>
<h3>5. No need to even guess, do a quick repair/rebuild.</h3>
    </div>

    <footer>
        <div class="pure-g post-footer">
            <div class="pure-u-1 pure-u-md-1-2">
                <div class="pure-g poster-info">
                    <div class="pure-u-3-4">
                        <h3 class="author-name"><a href="./author/shane-dowling.html">Shane Dowling</a></h3>
                        <p class="author-description">
                        </p>
                    </div>
                </div>
            </div>



        </div>


    </footer>


</div>


    <!-- Matomo -->
        <script>
          var _paq = window._paq = window._paq || [];
          /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
          _paq.push(['trackPageView']);
          _paq.push(['enableLinkTracking']);
          (function() {
            var u="//stats.shanedowling.com/";
            _paq.push(['setTrackerUrl', u+'matomo.php']);
                  _paq.push(['setSiteId', '1']);
            var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
            g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
          })();
        </script>
        <!-- End Matomo Code -->
</body>
</html>