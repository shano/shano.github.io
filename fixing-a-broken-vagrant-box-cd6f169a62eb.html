<!DOCTYPE html>
<html lang="en">
<head>
        <title>Shane Dowling : Fixing a broken vagrant box</title>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="./theme/css/main.css" type="text/css" />
        <link href="https://shanedowling.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Shane Dowling ATOM Feed" />

        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="./css/ie.css"/>
                <script src="./js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="./css/ie6.css"/><![endif]-->

</head>

<body>
        
<header>
    <h1><a href="." id="site-title">Shane Dowling </a> :
        <a href="./fixing-a-broken-vagrant-box-cd6f169a62eb.html" id="page-title">Fixing a broken vagrant box</a></h1>
<time datetime="2013-10-17T00:00:00+00:00">Thu 17 October 2013</time></header>
<article>
    <p><img alt="" src="images/1__TalXSpVG5yo__Lucbr1Wm6w.png"></p>
<p>The first time this happened I went into a cold sweat. My box with all
dev versions of my companies live databases had died. Of course I had
the box provisioned with salt so configuration wasn't a problem, but
grabbing all those databases, downloading, altering specific internal
values and inserting them was going to cost me hours. These steps
should've been salted too but I hadn't gotten round to it yet.</p>
<p>When I brought my vagrant box up, vagrant kept thinking that my original
box had gone and kept trying to re-create a new one and provisioning it.
Instead of starting from scratch I dug down and tried to figure out the
problem. This issue has happened on several occasions for me so I
figured I'd document the steps to fix it.
-</p>
<ol>
<li>Start up virtualbox and make sure the box is still there and working.</li>
<li>Sometimes I find that theÂ .vbox file can get corrupted. This sucks but go into the folder that contains the vbox file and see if there's a VM_NAME.vbox-prev and copy that back to VM_NAME.vbox and try to run it just via virtualbox to see if it picks back up. This was always my issue, I believe because my laptop sometimes ran out of space and virtualbox tries to write a new file it can't and simply writes something corrupted.</li>
</ol>
<p>Make sure Vagrant points to your working VirtualMachine</p>
<ol>
<li>While trying to get vagrant up and running again it may have create a bunch of similar boxes, get rid of those and retain the box you want to keep.</li>
<li>Run this VBoxManage list vms and get the GUID of your newly fixed box.</li>
<li>From the vagrant box directory go to .vagrant/machines/default/virtualbox and replace the contents of this file with just the GUID. <strong>Make sure no newline exists at the end of this file.</strong> This is key. A lot of editors will automatically add a newline here and won't present it when you attempt to delete the newline. Try diffing this id file with the id file from another vagrant box to see if the newline still appears. Otherwise, vim will also state noeol in it's statusbar to confirm there is no end of line.</li>
<li>Run vagrant status and see if it picks up your old box, if it doesn't make sure step 4 is correct.</li>
</ol>
<p>Test your VM</p>
<ol>
<li>Make sure none of the other VMs are still running. I use the <a href="https://github.com/joshmcarthur/vagrant-list">vagrant list plugin</a> for this. Once installed run vagrant list.</li>
<li>Then I shut down any that might conflict with my VM using VBoxManage controlvm VM_NAME poweroff</li>
<li>Then vagrant reload my vagrant box to ensure everything works.</li>
</ol>
</article>

        <footer>
            <nav>
                <ul>
                    <li><a href="./pages/contact.html">Contact</a></li>
                    <li>:: <a href="./categories.html">Categories</a></li>
                </ul>
            </nav>
        </footer>

</body>
</html>