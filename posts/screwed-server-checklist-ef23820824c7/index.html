<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Screwed Server Checklist | Shane Dowling</title><meta name=keywords content><meta name=description content="My servers started getting unusably slow at peak hours lately and I
decided, midst panic to vaguely attempt to document the various things I
had to go through to narrow down the problem, anyway I&rsquo;m sticking them
up here so a) I don&rsquo;t lose the list and b) it might be of use to someone
else. Some are obvious, some less so. I&rsquo;ve already forgotten half of
what I did to fix it, so here&rsquo;s the other half before I forget anything
else."><meta name=author content="Shane Dowling"><link rel=canonical href=https://shanedowling.com/posts/screwed-server-checklist-ef23820824c7/><link crossorigin=anonymous href=/assets/css/stylesheet.8fe10233a706bc87f2e08b3cf97b8bd4c0a80f10675a143675d59212121037c0.css integrity="sha256-j+ECM6cGvIfy4Is8+XuL1MCoDxBnWhQ2ddWSEhIQN8A=" rel="preload stylesheet" as=style><link rel=icon href=https://shanedowling.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://shanedowling.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://shanedowling.com/favicon-32x32.png><link rel=apple-touch-icon href=https://shanedowling.com/apple-touch-icon.png><link rel=mask-icon href=https://shanedowling.com/favicon.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://shanedowling.com/posts/screwed-server-checklist-ef23820824c7/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://shanedowling.com/posts/screwed-server-checklist-ef23820824c7/"><meta property="og:site_name" content="Shane Dowling"><meta property="og:title" content="Screwed Server Checklist"><meta property="og:description" content="My servers started getting unusably slow at peak hours lately and I decided, midst panic to vaguely attempt to document the various things I had to go through to narrow down the problem, anyway I’m sticking them up here so a) I don’t lose the list and b) it might be of use to someone else. Some are obvious, some less so. I’ve already forgotten half of what I did to fix it, so here’s the other half before I forget anything else."><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2012-04-28T00:00:00+00:00"><meta property="article:modified_time" content="2012-04-28T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Screwed Server Checklist"><meta name=twitter:description content="My servers started getting unusably slow at peak hours lately and I
decided, midst panic to vaguely attempt to document the various things I
had to go through to narrow down the problem, anyway I&rsquo;m sticking them
up here so a) I don&rsquo;t lose the list and b) it might be of use to someone
else. Some are obvious, some less so. I&rsquo;ve already forgotten half of
what I did to fix it, so here&rsquo;s the other half before I forget anything
else."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://shanedowling.com/posts/"},{"@type":"ListItem","position":2,"name":"Screwed Server Checklist","item":"https://shanedowling.com/posts/screwed-server-checklist-ef23820824c7/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Screwed Server Checklist","name":"Screwed Server Checklist","description":"My servers started getting unusably slow at peak hours lately and I decided, midst panic to vaguely attempt to document the various things I had to go through to narrow down the problem, anyway I\u0026rsquo;m sticking them up here so a) I don\u0026rsquo;t lose the list and b) it might be of use to someone else. Some are obvious, some less so. I\u0026rsquo;ve already forgotten half of what I did to fix it, so here\u0026rsquo;s the other half before I forget anything else.\n","keywords":[],"articleBody":"My servers started getting unusably slow at peak hours lately and I decided, midst panic to vaguely attempt to document the various things I had to go through to narrow down the problem, anyway I’m sticking them up here so a) I don’t lose the list and b) it might be of use to someone else. Some are obvious, some less so. I’ve already forgotten half of what I did to fix it, so here’s the other half before I forget anything else.\nNote:This is only meant to give you a pragmatic, last minute ditch attempt at diagnosing problems roughly. In essence, to give an idea of what to look for and dig when you come across signs of strangeness. I’m sure nagios, serverdensity, munin or whatever else can diagnose these things far quicker and better, so just assume we’re far beyond clever solutions. It’s essentially for the idiots like me who barely change any of their servers configuration to handle scaling at all well.\nother handy tips I should be aware of, let me know here.\nThis is meant for a LAMP install(more specifically ubuntu), so may be slanted that way, but most of the tips should work depending on your distro of choice.\nProcesses\ntop/htop -\u003e An obvious one, should be your first point of entry,\nMemory\nfree -m -\u003e Free ram, could there be a lot of IO to disk? Again, obvious.\nHard-Disk\ndf -h -\u003e Another obvious one, is your disk full?\nNetwork\nsudo iftop -\u003e This one requires installation on ubuntu but it’s in apt so shouldn’t be a big deal(unless of course your network is in fact screwed). Anyway, check those numbers, check your b/w restrictions, then do the math.\nDNS\nDoes banging the servers ip into your local hosts file speed this up? If so, it could be a DNS issue.\nMySQL\nwatch -n 1 mysqladmin — user=mysql_user — password=mysql_password processlist -\u003e This command will watch live mysql queries being executed. Noticing any crap queries running insanely long? This could be your issue.\nAnd directly related to slow crap queries do you have an large tables that say might be causing a serious performance issue? Here’s a mysql query to grab the largest tables on your server.\nSELECT CONCAT(table_schema, '.', table_name), CONCAT(ROUND(table_rows / 1000000, 2), 'M') rows, CONCAT(ROUND(data_length / ( 1024 * 1024 * 1024 ), 2), 'G') DATA, CONCAT(ROUND(index_length / ( 1024 * 1024 * 1024 ), 2), 'G') idx, CONCAT(ROUND(( data_length + index_length ) / ( 1024 * 1024 * 1024 ), 2), 'G') total_size, ROUND(index_length / data_length, 2) idxfrac FROM information_schema.TABLES ORDER BY data_length + index_length DESC LIMIT 10; Index your tables better or truncate crap you don’t need.\nApache\nps ax | grep apache | wc -l Let’s assume you didn’t change your ubuntu default apache configuration, if your MaxChild setting is at 150 and the value returned from the above command is stuck at over 150(wc will match the ps command too), then here’s your problem. It may “look” like your network is slow but in fact it’s apache being forced to queue requests.\nRun ps aux | grep apache and see how much ram apache is taking on your server(you should see roughly what each concurrent connection is getting in terms of ram percentage). Do some math and see if you have the free ram to increase max childs, if you can, do so.\nIf not, reduce the keepalive value(essentially this isn’t as scary as it sounds, quite a few major sites run without a keepalive value at all), but this entirely depends on your sites usage. Altering keepalive will lose you some speed, you’re essentially cycling through the concurrent requests faster, so request 151 doesn’t have to wait as long. But, you need to decide whether less speed for more people is better than speed with a hard concurrent limit.\nYou can also enable some of apache’s new cleverer keepalive modules but again that goes beyond the scope of the post.\n","wordCount":"665","inLanguage":"en","datePublished":"2012-04-28T00:00:00Z","dateModified":"2012-04-28T00:00:00Z","author":{"@type":"Person","name":"Shane Dowling"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://shanedowling.com/posts/screwed-server-checklist-ef23820824c7/"},"publisher":{"@type":"Organization","name":"Shane Dowling","logo":{"@type":"ImageObject","url":"https://shanedowling.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://shanedowling.com/ accesskey=h title="Shane Dowling (Alt + H)">Shane Dowling</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://shanedowling.com/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://shanedowling.com/categories/ title=Categories><span>Categories</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Screwed Server Checklist</h1><div class=post-meta><span title='2012-04-28 00:00:00 +0000 UTC'>April 28, 2012</span>&nbsp;·&nbsp;Shane Dowling</div></header><div class=post-content><p>My servers started getting unusably slow at peak hours lately and I
decided, midst panic to vaguely attempt to document the various things I
had to go through to narrow down the problem, anyway I&rsquo;m sticking them
up here so a) I don&rsquo;t lose the list and b) it might be of use to someone
else. Some are obvious, some less so. I&rsquo;ve already forgotten half of
what I did to fix it, so here&rsquo;s the other half before I forget anything
else.</p><p>Note:This is only meant to give you a pragmatic, last minute ditch
attempt at diagnosing problems roughly. In essence, to give an idea of
what to look for and dig when you come across signs of strangeness. I&rsquo;m
sure nagios, serverdensity, munin or whatever else can diagnose these
things far quicker and better, so just assume we&rsquo;re far beyond clever
solutions. It&rsquo;s essentially for the idiots like me who barely change any
of their servers configuration to handle scaling at all well.</p><p>other handy tips I should be aware of, let me know here.</p><p>This is meant for a LAMP install(more specifically ubuntu), so may be
slanted that way, but most of the tips should work depending on your
distro of choice.</p><p><strong>Processes</strong></p><p>top/htop -> An obvious one, should be your first point of entry,</p><p><strong>Memory</strong></p><p>free -m -> Free ram, could there be a lot of IO to disk? Again, obvious.</p><p><strong>Hard-Disk</strong></p><p>df -h -> Another obvious one, is your disk full?</p><p><strong>Network</strong></p><p>sudo iftop -> This one requires installation on ubuntu but it&rsquo;s in apt
so shouldn&rsquo;t be a big deal(unless of course your network is in fact
screwed). Anyway, check those numbers, check your b/w restrictions, then
do the math.</p><p><strong>DNS</strong></p><p>Does banging the servers ip into your local hosts file speed this up? If
so, it could be a DNS issue.</p><p><strong>MySQL</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>watch -n <span style=color:#ae81ff>1</span> mysqladmin — user<span style=color:#f92672>=</span>mysql_user — password<span style=color:#f92672>=</span>mysql_password processlist
</span></span></code></pre></div><p>-> This command will watch live mysql queries being executed. Noticing any crap queries running insanely long? This could be your issue.</p><p>And directly related to slow crap queries do you have an large tables
that say might be causing a serious performance issue? Here&rsquo;s a mysql
query to grab the largest tables on your server.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> CONCAT(table_schema, <span style=color:#e6db74>&#39;.&#39;</span>, <span style=color:#66d9ef>table_name</span>), CONCAT(ROUND(table_rows <span style=color:#f92672>/</span> <span style=color:#ae81ff>1000000</span>, <span style=color:#ae81ff>2</span>), <span style=color:#e6db74>&#39;M&#39;</span>) <span style=color:#66d9ef>rows</span>, CONCAT(ROUND(data_length <span style=color:#f92672>/</span> ( <span style=color:#ae81ff>1024</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>1024</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>1024</span> ), <span style=color:#ae81ff>2</span>), <span style=color:#e6db74>&#39;G&#39;</span>) <span style=color:#66d9ef>DATA</span>, CONCAT(ROUND(index_length <span style=color:#f92672>/</span> ( <span style=color:#ae81ff>1024</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>1024</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>1024</span> ), <span style=color:#ae81ff>2</span>), <span style=color:#e6db74>&#39;G&#39;</span>) idx, CONCAT(ROUND(( data_length <span style=color:#f92672>+</span> index_length ) <span style=color:#f92672>/</span> ( <span style=color:#ae81ff>1024</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>1024</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>1024</span> ), <span style=color:#ae81ff>2</span>), <span style=color:#e6db74>&#39;G&#39;</span>) total_size, ROUND(index_length <span style=color:#f92672>/</span> data_length, <span style=color:#ae81ff>2</span>) idxfrac <span style=color:#66d9ef>FROM</span> information_schema.TABLES <span style=color:#66d9ef>ORDER</span> <span style=color:#66d9ef>BY</span> data_length <span style=color:#f92672>+</span> index_length <span style=color:#66d9ef>DESC</span> <span style=color:#66d9ef>LIMIT</span> <span style=color:#ae81ff>10</span>;
</span></span></code></pre></div><p>Index your tables better or truncate crap you don&rsquo;t need.</p><p><strong>Apache</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ps ax | grep apache | wc -l
</span></span></code></pre></div><p>Let&rsquo;s assume you didn&rsquo;t change your ubuntu default apache configuration,
if your MaxChild setting is at 150 and the value returned from the above
command is stuck at over 150(wc will match the ps command too), then
here&rsquo;s your problem. It may &ldquo;look&rdquo; like your network is slow but in fact
it&rsquo;s apache being forced to queue requests.</p><p>Run ps aux | grep apache and see how much ram apache is taking on your
server(you should see roughly what each concurrent connection is getting
in terms of ram percentage). Do some math and see if you have the free
ram to increase max childs, if you can, do so.</p><p>If not, reduce the keepalive value(essentially this isn&rsquo;t as scary as it
sounds, quite a few major sites run without a keepalive value at all),
but this entirely depends on your sites usage. Altering keepalive will
lose you some speed, you&rsquo;re essentially cycling through the concurrent
requests faster, so request 151 doesn&rsquo;t have to wait as long. But, you
need to decide whether less speed for more people is better than speed
with a hard concurrent limit.</p><p>You can also enable some of apache&rsquo;s new cleverer keepalive modules but
again that goes beyond the scope of the post.</p></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://shanedowling.com/>Shane Dowling</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>