<!doctype html><html lang=en dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=8080&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="noindex, nofollow"><title>OfflineImap to Thunderbird | Shane Dowling</title><meta name=keywords content><meta name=description content="Last week I moved from Debian to Linux Mint and setup Thunderbird as my
new mail client(replacing mutt). Sadly for some reason Thunderbird
started tanking and wiped all the mails from my mailserver without
actually downloading anything.
I could&rsquo;ve restored the mails from a backup but instead I figured I&rsquo;d
take my emails offline and use Thunderbird as my primary mail client. I
had a backup of my mails from OfflineImap but the problem was that
OfflineImap uses the MailDir format and Thunderbird didn&rsquo;t support it."><meta name=author content="Shane Dowling"><link rel=canonical href=http://localhost:8080/posts/2014-02-08_offlineimap-to-thunderbird-152bb02286f/><link crossorigin=anonymous href=/assets/css/stylesheet.8fe10233a706bc87f2e08b3cf97b8bd4c0a80f10675a143675d59212121037c0.css integrity="sha256-j+ECM6cGvIfy4Is8+XuL1MCoDxBnWhQ2ddWSEhIQN8A=" rel="preload stylesheet" as=style><link rel=icon href=http://localhost:8080/favicon.ico><link rel=icon type=image/png sizes=16x16 href=http://localhost:8080/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=http://localhost:8080/favicon-32x32.png><link rel=apple-touch-icon href=http://localhost:8080/apple-touch-icon.png><link rel=mask-icon href=http://localhost:8080/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=http://localhost:8080/posts/2014-02-08_offlineimap-to-thunderbird-152bb02286f/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://localhost:8080/ accesskey=h title="Shane Dowling (Alt + H)">Shane Dowling</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://localhost:8080/posts/ title=Posts><span>Posts</span></a></li><li><a href=http://localhost:8080/categories/ title=Categories><span>Categories</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">OfflineImap to Thunderbird</h1><div class=post-meta><span title='2014-02-08 00:00:00 +0000 UTC'>February 8, 2014</span>&nbsp;·&nbsp;Shane Dowling</div></header><div class=post-content><p>Last week I moved from Debian to Linux Mint and setup Thunderbird as my
new mail client(replacing mutt). Sadly for some reason Thunderbird
started tanking and wiped all the mails from my mailserver without
actually downloading anything.</p><p>I could&rsquo;ve restored the mails from a backup but instead I figured I&rsquo;d
take my emails offline and use Thunderbird as my primary mail client. I
had a backup of my mails from OfflineImap but the problem was that
OfflineImap uses the MailDir format and Thunderbird didn&rsquo;t support it.</p><p>Luckily Thunderbird did support maildir and I modified an existing
MailDir to Mbox converter written in Python to work with Offlineimaps
potentially infinitely recursive folder format. Hopefully it helps
someone else.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>#!/usr/bin/env python</span>
</span></span><span style=display:flex><span> <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74> Shane Dowling, 8 Feb 2013
</span></span></span><span style=display:flex><span><span style=color:#e6db74> Frédéric Grosshans, 19 January 2012
</span></span></span><span style=display:flex><span><span style=color:#e6db74> Nathan R. Yergler, 6 June 2010
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>This file does not contain sufficient creative expression to invoke
</span></span></span><span style=display:flex><span><span style=color:#e6db74> assertion of copyright. No warranty is expressed or implied; use at
</span></span></span><span style=display:flex><span><span style=color:#e6db74> your own risk.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>— -
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Uses Python&#39;s included mailbox library to convert mail archives from
</span></span></span><span style=display:flex><span><span style=color:#e6db74> maildir [http://en.wikipedia.org/wiki/Maildir] to
</span></span></span><span style=display:flex><span><span style=color:#e6db74> mbox [http://en.wikipedia.org/wiki/Mbox] format, icluding subfolder.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>See [http://docs.python.org/library/mailbox.html#mailbox.Mailbox](http://docs.python.org/library/mailbox.html#mailbox.Mailbox) for
</span></span></span><span style=display:flex><span><span style=color:#e6db74> full documentation on this library.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>— -
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>$ python md2mb.py [maildir_path] [mbox_filename]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[maildir_path] should be the the path to the actual maildir (containing new,
</span></span></span><span style=display:flex><span><span style=color:#e6db74> cur, tmp, and the subfolders, which are hidden directories with names like
</span></span></span><span style=display:flex><span><span style=color:#e6db74> .subfolde.subsubfolder.subsubsbfolder);
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[mbox_filename] will be newly created, as well as a [mbox_filename].sbd the
</span></span></span><span style=display:flex><span><span style=color:#e6db74> directory.
</span></span></span><span style=display:flex><span><span style=color:#e6db74> &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> mailbox
</span></span><span style=display:flex><span> <span style=color:#f92672>import</span> sys
</span></span><span style=display:flex><span> <span style=color:#f92672>import</span> email
</span></span><span style=display:flex><span> <span style=color:#f92672>import</span> os
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>maildir2mailbox</span>(maildirname, mboxfilename):
</span></span><span style=display:flex><span> <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74> slightly adapted from maildir2mbox.py,
</span></span></span><span style=display:flex><span><span style=color:#e6db74> Nathan R. Yergler, 6 June 2010
</span></span></span><span style=display:flex><span><span style=color:#e6db74> [http://yergler.net/blog/2010/06/06/batteries-included-or-maildir-to-mbox-again/](http://yergler.net/blog/2010/06/06/batteries-included-or-maildir-to-mbox-again/)
</span></span></span><span style=display:flex><span><span style=color:#e6db74> and Frédéric Grosshans, 19 January 2012
</span></span></span><span style=display:flex><span><span style=color:#e6db74> [http://stackoverflow.com/questions/2501182/convert-maildir-to-mbox](http://stackoverflow.com/questions/2501182/convert-maildir-to-mbox)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span> <span style=color:#75715e># open the existing maildir and the target mbox file</span>
</span></span><span style=display:flex><span> maildir <span style=color:#f92672>=</span> mailbox<span style=color:#f92672>.</span>Maildir(maildirname, email<span style=color:#f92672>.</span>message_from_file)
</span></span><span style=display:flex><span> mbox <span style=color:#f92672>=</span> mailbox<span style=color:#f92672>.</span>mbox(mboxfilename)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># lock the mbox</span>
</span></span><span style=display:flex><span> mbox<span style=color:#f92672>.</span>lock()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># iterate over messages in the maildir and add to the mbox</span>
</span></span><span style=display:flex><span> mbox<span style=color:#f92672>.</span>add(msg)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># close and unlock</span>
</span></span><span style=display:flex><span> mbox<span style=color:#f92672>.</span>close()
</span></span><span style=display:flex><span> maildir<span style=color:#f92672>.</span>close()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#Creates the main mailbox</span>
</span></span><span style=display:flex><span> dirname<span style=color:#f92672>=</span>sys<span style=color:#f92672>.</span>argv[<span style=color:#f92672>-</span><span style=color:#ae81ff>2</span>]
</span></span><span style=display:flex><span> mboxname<span style=color:#f92672>=</span>sys<span style=color:#f92672>.</span>argv[<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>]
</span></span><span style=display:flex><span> mboxdirname<span style=color:#f92672>=</span>mboxname<span style=color:#f92672>+</span><span style=color:#e6db74>&#39;.sbd&#39;</span>
</span></span><span style=display:flex><span> <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>exists(mboxdirname): os<span style=color:#f92672>.</span>makedirs(mboxdirname)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Iterate over all folders</span>
</span></span><span style=display:flex><span> <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>folder_iterate</span>(dirname, mboxname):
</span></span><span style=display:flex><span> listofdirs<span style=color:#f92672>=</span>[dn <span style=color:#66d9ef>for</span> dn <span style=color:#f92672>in</span> os<span style=color:#f92672>.</span>walk(dirname)<span style=color:#f92672>.</span>next()[<span style=color:#ae81ff>1</span>] <span style=color:#66d9ef>if</span> dn <span style=color:#f92672>not</span> <span style=color:#f92672>in</span> [<span style=color:#e6db74>&#39;new&#39;</span>, <span style=color:#e6db74>&#39;cur&#39;</span>, <span style=color:#e6db74>&#39;tmp&#39;</span>]]
</span></span><span style=display:flex><span> curlist<span style=color:#f92672>=</span>[mboxname]<span style=color:#f92672>+</span>curfold<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#39;.&#39;</span>)
</span></span><span style=display:flex><span> curpath<span style=color:#f92672>=</span>os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>join(<span style=color:#f92672>*</span>[dn<span style=color:#f92672>+</span><span style=color:#e6db74>&#39;.sbd&#39;</span> <span style=color:#66d9ef>for</span> dn <span style=color:#f92672>in</span> curlist <span style=color:#66d9ef>if</span> dn])
</span></span><span style=display:flex><span> <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>exists(curpath): os<span style=color:#f92672>.</span>makedirs(curpath)
</span></span><span style=display:flex><span> maildir2mailbox(os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>join(dirname,curfold),curpath[:<span style=color:#f92672>-</span><span style=color:#ae81ff>4</span>])
</span></span><span style=display:flex><span> print(<span style=color:#e6db74>&#39;no maildir folders&#39;</span>)
</span></span><span style=display:flex><span> folder_iterate(os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>join(dirname,curfold), mboxname)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>folder_iterate(dirname, mboxname)
</span></span><span style=display:flex><span> print(<span style=color:#e6db74>&#39;Done&#39;</span>)
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=http://localhost:8080/>Shane Dowling</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>