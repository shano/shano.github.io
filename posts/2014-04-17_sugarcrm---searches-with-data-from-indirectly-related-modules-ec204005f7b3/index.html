<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>SugarCRM — Searches with data from indirectly related modules | Shane Dowling</title><meta name=keywords content><meta name=description content="Building modules in SugarCRM can cause you to create a boatload of
unnecessary relationships, simply because it&rsquo;s convenient to do so.
Maybe you&rsquo;d have a relationship where A relates to B and B to C but
you&rsquo;d like to search for all A module records that relate to C. One
option is to maybe related A to C and maintain the relationships by
using hooks on save to preserve the A-C relationship. That way you could
leverage Sugar relate fields and indirect searching, but that can be a
messy choice that adds a lot of complexity if overused."><meta name=author content="Shane Dowling"><link rel=canonical href=https://shanedowling.com/posts/2014-04-17_sugarcrm---searches-with-data-from-indirectly-related-modules-ec204005f7b3/><link crossorigin=anonymous href=/assets/css/stylesheet.8fe10233a706bc87f2e08b3cf97b8bd4c0a80f10675a143675d59212121037c0.css integrity="sha256-j+ECM6cGvIfy4Is8+XuL1MCoDxBnWhQ2ddWSEhIQN8A=" rel="preload stylesheet" as=style><link rel=icon href=https://shanedowling.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://shanedowling.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://shanedowling.com/favicon-32x32.png><link rel=apple-touch-icon href=https://shanedowling.com/apple-touch-icon.png><link rel=mask-icon href=https://shanedowling.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://shanedowling.com/posts/2014-04-17_sugarcrm---searches-with-data-from-indirectly-related-modules-ec204005f7b3/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://shanedowling.com/posts/2014-04-17_sugarcrm---searches-with-data-from-indirectly-related-modules-ec204005f7b3/"><meta property="og:site_name" content="Shane Dowling"><meta property="og:title" content="SugarCRM — Searches with data from indirectly related modules"><meta property="og:description" content="Building modules in SugarCRM can cause you to create a boatload of unnecessary relationships, simply because it’s convenient to do so. Maybe you’d have a relationship where A relates to B and B to C but you’d like to search for all A module records that relate to C. One option is to maybe related A to C and maintain the relationships by using hooks on save to preserve the A-C relationship. That way you could leverage Sugar relate fields and indirect searching, but that can be a messy choice that adds a lot of complexity if overused."><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2014-04-17T00:00:00+00:00"><meta property="article:modified_time" content="2014-04-17T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="SugarCRM — Searches with data from indirectly related modules"><meta name=twitter:description content="Building modules in SugarCRM can cause you to create a boatload of
unnecessary relationships, simply because it&rsquo;s convenient to do so.
Maybe you&rsquo;d have a relationship where A relates to B and B to C but
you&rsquo;d like to search for all A module records that relate to C. One
option is to maybe related A to C and maintain the relationships by
using hooks on save to preserve the A-C relationship. That way you could
leverage Sugar relate fields and indirect searching, but that can be a
messy choice that adds a lot of complexity if overused."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://shanedowling.com/posts/"},{"@type":"ListItem","position":2,"name":"SugarCRM — Searches with data from indirectly related modules","item":"https://shanedowling.com/posts/2014-04-17_sugarcrm---searches-with-data-from-indirectly-related-modules-ec204005f7b3/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"SugarCRM — Searches with data from indirectly related modules","name":"SugarCRM — Searches with data from indirectly related modules","description":"Building modules in SugarCRM can cause you to create a boatload of unnecessary relationships, simply because it\u0026rsquo;s convenient to do so. Maybe you\u0026rsquo;d have a relationship where A relates to B and B to C but you\u0026rsquo;d like to search for all A module records that relate to C. One option is to maybe related A to C and maintain the relationships by using hooks on save to preserve the A-C relationship. That way you could leverage Sugar relate fields and indirect searching, but that can be a messy choice that adds a lot of complexity if overused.\n","keywords":[],"articleBody":"Building modules in SugarCRM can cause you to create a boatload of unnecessary relationships, simply because it’s convenient to do so. Maybe you’d have a relationship where A relates to B and B to C but you’d like to search for all A module records that relate to C. One option is to maybe related A to C and maintain the relationships by using hooks on save to preserve the A-C relationship. That way you could leverage Sugar relate fields and indirect searching, but that can be a messy choice that adds a lot of complexity if overused.\nThe alternative is to keep the relationship structure as it is and add a new field to the search and build a custom subselect statement. For this example we’re adding a Drop-Down to Accounts to allow a user to search which Accounts are indirectly related to Performers via Events. Say we wish to present a drop-down on Accounts of all performers and if you search, it will return all Accounts attached to the specified Performer.\nGet the data for the drop-down In custom/modules/Accounts/getCustomDropDown.php\nrequire_once(\"modules/Performers/Performers.php\"); function galleryPerformers($focus, $field, $value, $view, $tabindex='0') { $performersBean = BeanFactory::getBean('Performers'); $performers = $performersBean-\u003eget_full_list(); $html = \" — \"; $selected_performer = $_REQUEST['performer_type_search']; // Or whatever dom id your drop-down has foreach($performers as $performer) { $html .= \" if($selected_performer == $performer-\u003eid) { // Props to Igor who flagged this in the comments! $html .= \"selected\"; } $html .=\" value='{$performer-\u003eid}'\u003e{$performer-\u003ename}\"; } return $html; } Present the drop-down on the accounts search Note This has to go into modules/Accounts(I know, I know), but this had to break updatability to work otherwise this will wipe with a quick repair/rebuild(if you put it in custom). If you find an alternative solution put it here.\nSo in modules/Accounts/metadata/vardefs.php\n$dictionary[\"Account\"][\"fields\"][\"performer_type_search\"] = array( 'name' =\u003e 'test', 'vname' =\u003e 'test', 'type' =\u003e 'varchar', // function to call that will return html that will be inserted 'function' =\u003e array( 'name' =\u003e 'galleryPerformer', 'returns' =\u003e 'html', 'include' =\u003e 'custom/modules/Accounts/getCustomDropDown.php'), 'required' =\u003e false, 'do_report' =\u003e false, 'reportable' =\u003e false, 'comment' =\u003e 'Performer Searching', 'source' =\u003e 'non-db' ); Extend the search Now that you have your drop-down working you need to extend the search to do what you need.\ncustom/modules/Accounts/metadata/SearchFields.php\n'performer_search' =\u003e array( 'query_type' =\u003e 'default', 'operator' =\u003e 'subquery', 'subquery' =\u003e 'SELECT accounts.id FROM accounts LEFT JOIN account_event acc_evt ON acc_evt.\\`account_ida\\` = accounts.id LEFT JOIN performers_event per_evt ON pvt_evt.\\`event_idb\\` = acc_evt.\\`performers_idb\\` WHERE acc_evt.deleted = 0 AND pvt_evt.deleted = 0 AND accounts.deleted = 0 AND pvt_evt.\\`fair_ida\\` LIKE', 'db_field' =\u003e array('id'), 'type' =\u003e 'enum', ), Now this query probably looks a little weird, but basically it’s an almost pseudocode type query that simply connected the two lookup tables between Accounts and Events then Events and Performers and does the where on the performers id.\nNote the LIKE in the query. Even if you’re querying IDs, Sugar stupidly passes in the value with a % at the end. So make sure this is LIKE statement.\n","wordCount":"490","inLanguage":"en","datePublished":"2014-04-17T00:00:00Z","dateModified":"2014-04-17T00:00:00Z","author":{"@type":"Person","name":"Shane Dowling"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://shanedowling.com/posts/2014-04-17_sugarcrm---searches-with-data-from-indirectly-related-modules-ec204005f7b3/"},"publisher":{"@type":"Organization","name":"Shane Dowling","logo":{"@type":"ImageObject","url":"https://shanedowling.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://shanedowling.com/ accesskey=h title="Shane Dowling (Alt + H)">Shane Dowling</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://shanedowling.com/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://shanedowling.com/categories/ title=Categories><span>Categories</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">SugarCRM — Searches with data from indirectly related modules</h1><div class=post-meta><span title='2014-04-17 00:00:00 +0000 UTC'>April 17, 2014</span>&nbsp;·&nbsp;Shane Dowling</div></header><div class=post-content><p>Building modules in SugarCRM can cause you to create a boatload of
unnecessary relationships, simply because it&rsquo;s convenient to do so.
Maybe you&rsquo;d have a relationship where A relates to B and B to C but
you&rsquo;d like to search for all A module records that relate to C. One
option is to maybe related A to C and maintain the relationships by
using hooks on save to preserve the A-C relationship. That way you could
leverage Sugar relate fields and indirect searching, but that can be a
messy choice that adds a lot of complexity if overused.</p><p>The alternative is to keep the relationship structure as it is and add a
new field to the search and build a custom subselect statement. For this
example we&rsquo;re adding a Drop-Down to Accounts to allow a user to search
which Accounts are indirectly related to Performers via Events. Say we
wish to present a drop-down on Accounts of all performers and if you
search, it will return all Accounts attached to the specified Performer.</p><h3 id=get-the-data-for-the-drop-down>Get the data for the drop-down<a hidden class=anchor aria-hidden=true href=#get-the-data-for-the-drop-down>#</a></h3><p>In custom/modules/Accounts/getCustomDropDown.php</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#66d9ef>require_once</span>(<span style=color:#e6db74>&#34;modules/Performers/Performers.php&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>galleryPerformers</span>($focus, $field, $value, $view, $tabindex<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;0&#39;</span>) {
</span></span><span style=display:flex><span> $performersBean <span style=color:#f92672>=</span> <span style=color:#a6e22e>BeanFactory</span><span style=color:#f92672>::</span><span style=color:#a6e22e>getBean</span>(<span style=color:#e6db74>&#39;Performers&#39;</span>);
</span></span><span style=display:flex><span> $performers <span style=color:#f92672>=</span> $performersBean<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>get_full_list</span>();
</span></span><span style=display:flex><span> $html <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34; — &#34;</span>;
</span></span><span style=display:flex><span> $selected_performer <span style=color:#f92672>=</span> $_REQUEST[<span style=color:#e6db74>&#39;performer_type_search&#39;</span>]; <span style=color:#75715e>// Or whatever dom id your drop-down has
</span></span></span><span style=display:flex><span><span style=color:#75715e></span> <span style=color:#66d9ef>foreach</span>($performers <span style=color:#66d9ef>as</span> $performer) {
</span></span><span style=display:flex><span> $html <span style=color:#f92672>.=</span> <span style=color:#e6db74>&#34; if(</span><span style=color:#e6db74>$selected_performer</span><span style=color:#e6db74> == </span><span style=color:#e6db74>$performer-&gt;id</span><span style=color:#e6db74>) { // Props to Igor who flagged this in the comments!
</span></span></span><span style=display:flex><span><span style=color:#e6db74> </span><span style=color:#e6db74>$html</span><span style=color:#e6db74> .= &#34;</span><span style=color:#a6e22e>selected</span><span style=color:#e6db74>&#34;;
</span></span></span><span style=display:flex><span><span style=color:#e6db74> }
</span></span></span><span style=display:flex><span><span style=color:#e6db74> </span><span style=color:#e6db74>$html</span><span style=color:#e6db74> .=&#34;</span> <span style=color:#a6e22e>value</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;{$performer-&gt;id}&#39;</span><span style=color:#f92672>&gt;</span>{$performer<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>name</span>}<span style=color:#e6db74>&#34;;
</span></span></span><span style=display:flex><span><span style=color:#e6db74> }
</span></span></span><span style=display:flex><span><span style=color:#e6db74> return </span><span style=color:#e6db74>$html</span><span style=color:#e6db74>;
</span></span></span><span style=display:flex><span><span style=color:#e6db74> }
</span></span></span></code></pre></div><h3 id=present-the-drop-down-on-the-accountssearch>Present the drop-down on the accounts search<a hidden class=anchor aria-hidden=true href=#present-the-drop-down-on-the-accountssearch>#</a></h3><p>Note This has to go into modules/Accounts(I know, I know), but this had
to break updatability to work otherwise this will wipe with a quick
repair/rebuild(if you put it in custom). If you find an alternative
solution put it here.</p><p>So in modules/Accounts/metadata/vardefs.php</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span>$dictionary[<span style=color:#e6db74>&#34;Account&#34;</span>][<span style=color:#e6db74>&#34;fields&#34;</span>][<span style=color:#e6db74>&#34;performer_type_search&#34;</span>] <span style=color:#f92672>=</span> <span style=color:#66d9ef>array</span>(
</span></span><span style=display:flex><span> <span style=color:#e6db74>&#39;name&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;test&#39;</span>,
</span></span><span style=display:flex><span> <span style=color:#e6db74>&#39;vname&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;test&#39;</span>,
</span></span><span style=display:flex><span> <span style=color:#e6db74>&#39;type&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;varchar&#39;</span>, <span style=color:#75715e>// function to call that will return html that will be inserted
</span></span></span><span style=display:flex><span><span style=color:#75715e></span> <span style=color:#e6db74>&#39;function&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>array</span>(
</span></span><span style=display:flex><span> <span style=color:#e6db74>&#39;name&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;galleryPerformer&#39;</span>,
</span></span><span style=display:flex><span> <span style=color:#e6db74>&#39;returns&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;html&#39;</span>,
</span></span><span style=display:flex><span> <span style=color:#e6db74>&#39;include&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;custom/modules/Accounts/getCustomDropDown.php&#39;</span>),
</span></span><span style=display:flex><span> <span style=color:#e6db74>&#39;required&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex><span> <span style=color:#e6db74>&#39;do_report&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex><span> <span style=color:#e6db74>&#39;reportable&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex><span> <span style=color:#e6db74>&#39;comment&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;Performer Searching&#39;</span>,
</span></span><span style=display:flex><span> <span style=color:#e6db74>&#39;source&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;non-db&#39;</span>
</span></span><span style=display:flex><span> );
</span></span></code></pre></div><h3 id=extend-thesearch>Extend the search<a hidden class=anchor aria-hidden=true href=#extend-thesearch>#</a></h3><p>Now that you have your drop-down working you need to extend the search
to do what you need.</p><p>custom/modules/Accounts/metadata/SearchFields.php</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#e6db74>&#39;performer_search&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>array</span>(
</span></span><span style=display:flex><span> <span style=color:#e6db74>&#39;query_type&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;default&#39;</span>,
</span></span><span style=display:flex><span> <span style=color:#e6db74>&#39;operator&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;subquery&#39;</span>,
</span></span><span style=display:flex><span> <span style=color:#e6db74>&#39;subquery&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;SELECT accounts.id FROM accounts LEFT JOIN account_event acc_evt ON acc_evt.\`account_ida\` = accounts.id LEFT JOIN performers_event per_evt ON pvt_evt.\`event_idb\` = acc_evt.\`performers_idb\` WHERE acc_evt.deleted = 0 AND pvt_evt.deleted = 0 AND accounts.deleted = 0 AND pvt_evt.\`fair_ida\` LIKE&#39;</span>,
</span></span><span style=display:flex><span> <span style=color:#e6db74>&#39;db_field&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>array</span>(<span style=color:#e6db74>&#39;id&#39;</span>),
</span></span><span style=display:flex><span> <span style=color:#e6db74>&#39;type&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;enum&#39;</span>, ),
</span></span></code></pre></div><p>Now this query probably looks a little weird, but basically it&rsquo;s an
almost pseudocode type query that simply connected the two lookup tables
between Accounts and Events then Events and Performers and does the
where on the performers id.</p><p>Note the LIKE in the query. Even if you&rsquo;re querying IDs, Sugar stupidly
passes in the value with a % at the end. So make sure this is LIKE
statement.</p></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://shanedowling.com/>Shane Dowling</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>