<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>SugarCRM 7 — Custom subpanels | Shane Dowling</title>
<meta name=keywords content><meta name=description content="
This tutorial should hopefully help you to create a new subpanel under
the Contacts module in Sugar using a custom link class and driven by
SugarCRM 7&rsquo;s new SugarQuery API.
1. Create a new link class
This should go into custom/modules//YourNewLink.php and this
class will act as the custom functionality that will build your link
between the two records.
/**
 * Custom filtered link
 */
 class YourNewLink extends Link2
 {
 /**
 * DB
 *
 * @var DBManager
 */
 protected $db;

public function __construct($linkName, $bean, $linkDef = false)
 {
 $this->focus = $bean;
 $this->name = $linkName;
 $this->db = DBManagerFactory::getInstance();
 if (empty($linkDef)) {
 $this->def = $bean->field_defs[$linkName];
 } else {
 $this->def = $linkDef;
 }
 }

/**
 * Returns false if no relationship was found for this link
 *
 * @return bool
 */
 public function loadedSuccesfully()
 {
 // this link always loads successfully
 return true;
 }

/**
 * @see Link2::getRelatedModuleName()
 */
 public function getRelatedModuleName()
 {
 return '';
 }

/**
 *
 * @see Link2::buildJoinSugarQuery()
 */
 public function buildJoinSugarQuery($sugar_query, $options = array())
 {
 $joinParams = array('joinType' => isset($options['joinType']) ? $options['joinType'] : 'INNER');
 $jta = 'active_other_invites';
 if (!empty($options['joinTableAlias'])) {
 $jta = $joinParams['alias'] = $options['joinTableAlias'];
 }

$sugar_query->joinRaw($this->getCustomJoin($options), $joinParams);
 return $sugar_query->join[$jta];
 }

/**
 * Builds main join subpanel
 * @param string $params
 * @return string JOIN clause
 */
 protected function getCustomJoin($params = array())
 {
 $bean_id = $this->db->quoted($this->focus->id);
 $sql = &#34; INNER JOIN(&#34;;
 $sql .= &#34;SELECT id FROM accounts WHERE id={$bean_id}&#34;; // This is essentially a select statement that will return a set of ids that you can match with the existing sugar_query
 $sql .= &#34;) accounts_result ON accounts_result.id = sugar_query_table.id&#34;;
 return $sql;
 }
 }
The argument $sugar_query is a new SugarQuery object, the details of
which are documented here.
What you essentially need to do is extend this query with whatever
join/filters you wish to add. This is done in the inner join I&rsquo;ve
specified."><meta name=author content="Shane Dowling"><link rel=canonical href=https://shanedowling.com/posts/sugarcrm-7-custom-subpanels-a75e66374a5b/><link crossorigin=anonymous href=/assets/css/stylesheet.2211ca3164be7830024f6aad2b3a2e520843a64f8f048445c3401c1249aa051d.css integrity="sha256-IhHKMWS+eDACT2qtKzouUghDpk+PBIRFw0AcEkmqBR0=" rel="preload stylesheet" as=style><link rel=icon href=https://shanedowling.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://shanedowling.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://shanedowling.com/favicon-32x32.png><link rel=apple-touch-icon href=https://shanedowling.com/apple-touch-icon.png><link rel=mask-icon href=https://shanedowling.com/favicon.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://shanedowling.com/posts/sugarcrm-7-custom-subpanels-a75e66374a5b/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script src=https://brightpin.com/script.js data-site=f93d4c22-b475-476d-8d86-8ec34fffe005 data-endpoint=https://brightpin.com/collect async></script><meta property="og:url" content="https://shanedowling.com/posts/sugarcrm-7-custom-subpanels-a75e66374a5b/"><meta property="og:site_name" content="Shane Dowling"><meta property="og:title" content="SugarCRM 7 — Custom subpanels"><meta property="og:description" content="
This tutorial should hopefully help you to create a new subpanel under the Contacts module in Sugar using a custom link class and driven by SugarCRM 7’s new SugarQuery API.
1. Create a new link class This should go into custom/modules//YourNewLink.php and this class will act as the custom functionality that will build your link between the two records.
/** * Custom filtered link */ class YourNewLink extends Link2 { /** * DB * * @var DBManager */ protected $db; public function __construct($linkName, $bean, $linkDef = false) { $this->focus = $bean; $this->name = $linkName; $this->db = DBManagerFactory::getInstance(); if (empty($linkDef)) { $this->def = $bean->field_defs[$linkName]; } else { $this->def = $linkDef; } } /** * Returns false if no relationship was found for this link * * @return bool */ public function loadedSuccesfully() { // this link always loads successfully return true; } /** * @see Link2::getRelatedModuleName() */ public function getRelatedModuleName() { return ''; } /** * * @see Link2::buildJoinSugarQuery() */ public function buildJoinSugarQuery($sugar_query, $options = array()) { $joinParams = array('joinType' => isset($options['joinType']) ? $options['joinType'] : 'INNER'); $jta = 'active_other_invites'; if (!empty($options['joinTableAlias'])) { $jta = $joinParams['alias'] = $options['joinTableAlias']; } $sugar_query->joinRaw($this->getCustomJoin($options), $joinParams); return $sugar_query->join[$jta]; } /** * Builds main join subpanel * @param string $params * @return string JOIN clause */ protected function getCustomJoin($params = array()) { $bean_id = $this->db->quoted($this->focus->id); $sql = &#34; INNER JOIN(&#34;; $sql .= &#34;SELECT id FROM accounts WHERE id={$bean_id}&#34;; // This is essentially a select statement that will return a set of ids that you can match with the existing sugar_query $sql .= &#34;) accounts_result ON accounts_result.id = sugar_query_table.id&#34;; return $sql; } } The argument $sugar_query is a new SugarQuery object, the details of which are documented here. What you essentially need to do is extend this query with whatever join/filters you wish to add. This is done in the inner join I’ve specified."><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2014-08-13T00:00:00+00:00"><meta property="article:modified_time" content="2014-08-13T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="SugarCRM 7 — Custom subpanels"><meta name=twitter:description content="
This tutorial should hopefully help you to create a new subpanel under
the Contacts module in Sugar using a custom link class and driven by
SugarCRM 7&rsquo;s new SugarQuery API.
1. Create a new link class
This should go into custom/modules//YourNewLink.php and this
class will act as the custom functionality that will build your link
between the two records.
/**
 * Custom filtered link
 */
 class YourNewLink extends Link2
 {
 /**
 * DB
 *
 * @var DBManager
 */
 protected $db;

public function __construct($linkName, $bean, $linkDef = false)
 {
 $this->focus = $bean;
 $this->name = $linkName;
 $this->db = DBManagerFactory::getInstance();
 if (empty($linkDef)) {
 $this->def = $bean->field_defs[$linkName];
 } else {
 $this->def = $linkDef;
 }
 }

/**
 * Returns false if no relationship was found for this link
 *
 * @return bool
 */
 public function loadedSuccesfully()
 {
 // this link always loads successfully
 return true;
 }

/**
 * @see Link2::getRelatedModuleName()
 */
 public function getRelatedModuleName()
 {
 return '';
 }

/**
 *
 * @see Link2::buildJoinSugarQuery()
 */
 public function buildJoinSugarQuery($sugar_query, $options = array())
 {
 $joinParams = array('joinType' => isset($options['joinType']) ? $options['joinType'] : 'INNER');
 $jta = 'active_other_invites';
 if (!empty($options['joinTableAlias'])) {
 $jta = $joinParams['alias'] = $options['joinTableAlias'];
 }

$sugar_query->joinRaw($this->getCustomJoin($options), $joinParams);
 return $sugar_query->join[$jta];
 }

/**
 * Builds main join subpanel
 * @param string $params
 * @return string JOIN clause
 */
 protected function getCustomJoin($params = array())
 {
 $bean_id = $this->db->quoted($this->focus->id);
 $sql = &#34; INNER JOIN(&#34;;
 $sql .= &#34;SELECT id FROM accounts WHERE id={$bean_id}&#34;; // This is essentially a select statement that will return a set of ids that you can match with the existing sugar_query
 $sql .= &#34;) accounts_result ON accounts_result.id = sugar_query_table.id&#34;;
 return $sql;
 }
 }
The argument $sugar_query is a new SugarQuery object, the details of
which are documented here.
What you essentially need to do is extend this query with whatever
join/filters you wish to add. This is done in the inner join I&rsquo;ve
specified."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://shanedowling.com/posts/"},{"@type":"ListItem","position":2,"name":"SugarCRM 7 — Custom subpanels","item":"https://shanedowling.com/posts/sugarcrm-7-custom-subpanels-a75e66374a5b/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"SugarCRM 7 — Custom subpanels","name":"SugarCRM 7 — Custom subpanels","description":"\nThis tutorial should hopefully help you to create a new subpanel under the Contacts module in Sugar using a custom link class and driven by SugarCRM 7\u0026rsquo;s new SugarQuery API.\n1. Create a new link class This should go into custom/modules//YourNewLink.php and this class will act as the custom functionality that will build your link between the two records.\n/** * Custom filtered link */ class YourNewLink extends Link2 { /** * DB * * @var DBManager */ protected $db; public function __construct($linkName, $bean, $linkDef = false) { $this-\u0026gt;focus = $bean; $this-\u0026gt;name = $linkName; $this-\u0026gt;db = DBManagerFactory::getInstance(); if (empty($linkDef)) { $this-\u0026gt;def = $bean-\u0026gt;field_defs[$linkName]; } else { $this-\u0026gt;def = $linkDef; } } /** * Returns false if no relationship was found for this link * * @return bool */ public function loadedSuccesfully() { // this link always loads successfully return true; } /** * @see Link2::getRelatedModuleName() */ public function getRelatedModuleName() { return \u0026#39;\u0026#39;; } /** * * @see Link2::buildJoinSugarQuery() */ public function buildJoinSugarQuery($sugar_query, $options = array()) { $joinParams = array(\u0026#39;joinType\u0026#39; =\u0026gt; isset($options[\u0026#39;joinType\u0026#39;]) ? $options[\u0026#39;joinType\u0026#39;] : \u0026#39;INNER\u0026#39;); $jta = \u0026#39;active_other_invites\u0026#39;; if (!empty($options[\u0026#39;joinTableAlias\u0026#39;])) { $jta = $joinParams[\u0026#39;alias\u0026#39;] = $options[\u0026#39;joinTableAlias\u0026#39;]; } $sugar_query-\u0026gt;joinRaw($this-\u0026gt;getCustomJoin($options), $joinParams); return $sugar_query-\u0026gt;join[$jta]; } /** * Builds main join subpanel * @param string $params * @return string JOIN clause */ protected function getCustomJoin($params = array()) { $bean_id = $this-\u0026gt;db-\u0026gt;quoted($this-\u0026gt;focus-\u0026gt;id); $sql = \u0026#34; INNER JOIN(\u0026#34;; $sql .= \u0026#34;SELECT id FROM accounts WHERE id={$bean_id}\u0026#34;; // This is essentially a select statement that will return a set of ids that you can match with the existing sugar_query $sql .= \u0026#34;) accounts_result ON accounts_result.id = sugar_query_table.id\u0026#34;; return $sql; } } The argument $sugar_query is a new SugarQuery object, the details of which are documented here. What you essentially need to do is extend this query with whatever join/filters you wish to add. This is done in the inner join I\u0026rsquo;ve specified.\n","keywords":[],"articleBody":"\nThis tutorial should hopefully help you to create a new subpanel under the Contacts module in Sugar using a custom link class and driven by SugarCRM 7’s new SugarQuery API.\n1. Create a new link class This should go into custom/modules//YourNewLink.php and this class will act as the custom functionality that will build your link between the two records.\n/** * Custom filtered link */ class YourNewLink extends Link2 { /** * DB * * @var DBManager */ protected $db; public function __construct($linkName, $bean, $linkDef = false) { $this-\u003efocus = $bean; $this-\u003ename = $linkName; $this-\u003edb = DBManagerFactory::getInstance(); if (empty($linkDef)) { $this-\u003edef = $bean-\u003efield_defs[$linkName]; } else { $this-\u003edef = $linkDef; } } /** * Returns false if no relationship was found for this link * * @return bool */ public function loadedSuccesfully() { // this link always loads successfully return true; } /** * @see Link2::getRelatedModuleName() */ public function getRelatedModuleName() { return ''; } /** * * @see Link2::buildJoinSugarQuery() */ public function buildJoinSugarQuery($sugar_query, $options = array()) { $joinParams = array('joinType' =\u003e isset($options['joinType']) ? $options['joinType'] : 'INNER'); $jta = 'active_other_invites'; if (!empty($options['joinTableAlias'])) { $jta = $joinParams['alias'] = $options['joinTableAlias']; } $sugar_query-\u003ejoinRaw($this-\u003egetCustomJoin($options), $joinParams); return $sugar_query-\u003ejoin[$jta]; } /** * Builds main join subpanel * @param string $params * @return string JOIN clause */ protected function getCustomJoin($params = array()) { $bean_id = $this-\u003edb-\u003equoted($this-\u003efocus-\u003eid); $sql = \" INNER JOIN(\"; $sql .= \"SELECT id FROM accounts WHERE id={$bean_id}\"; // This is essentially a select statement that will return a set of ids that you can match with the existing sugar_query $sql .= \") accounts_result ON accounts_result.id = sugar_query_table.id\"; return $sql; } } The argument $sugar_query is a new SugarQuery object, the details of which are documented here. What you essentially need to do is extend this query with whatever join/filters you wish to add. This is done in the inner join I’ve specified.\nNote: The inner join can get really complicated, so if you want a real working example, checkout modules/Emails/ArchivedEmailsLink.php and how the core sugar team use this. I can confirm however that this does work with custom joins.\nHere is the getEmailsJoin to help you understand what you can actually produce via this custom join.\n/** * Builds main join for archived emails * @param string $params * @return string JOIN clause */ protected function getEmailsJoin($params = array()) { $bean_id = $this-\u003edb-\u003equoted($this-\u003efocus-\u003eid); if (!empty($params['join_table_alias'])) { $table_name = $params['join_table_alias']; } else { $table_name = 'emails'; } return \"INNER JOIN (\\\\n\". // directly assigned emails \"select eb.email_id, 'direct' source FROM emails_beans eb where eb.bean_module = '{$this-\u003efocus-\u003emodule_dir}' AND eb.bean_id = $bean_id AND eb.deleted=0\\\\n\" . \" UNION \". // Related by directly by email \"select DISTINCT eear.email_id, 'relate' source from emails_email_addr_rel eear INNER JOIN email_addr_bean_rel eabr ON eabr.bean_id = $bean_id AND eabr.bean_module = '{$this-\u003efocus-\u003emodule_dir}' AND eabr.email_address_id = eear.email_address_id and eabr.deleted=0 where eear.deleted=0\\\\n\" . \") email_ids ON $table_name.id=email_ids.email_id \"; } 2. Add a new vardef entry for the linkfield. For this example, I’m going to create the custom link on the contacts module. So this code goes in custom/Extension/modules/Contacts/Ext/Vardefs/your_field_name.php\n$dictionary[\"Contact\"][\"fields\"][\"your_field_name\"] = array( 'name' =\u003e 'active_other_invites', 'type' =\u003e 'link', 'link_file' =\u003e 'custom/modules//YourNewLink.php', 'link_class' =\u003e 'YourNewLink', 'source' =\u003e 'non-db', 'vname' =\u003e 'LBL_NEW_LINK', 'module' =\u003e '', 'link_type' =\u003e 'many', 'relationship' =\u003e '', ); 3. Add the new link as a subpanel custom/Extension/modules/Contacts/Ext/clients/base/layouts/subpanels/your_subpanel_name.php\n$viewdefs['Contacts']['base']['layout']['subpanels']['components'][] = array ( 'layout' =\u003e 'subpanel', 'label' =\u003e 'LBL_NEW_LINK', 'context' =\u003e array ( 'link' =\u003e 'your_field_name', ), ); 4. Add the label custom/Extension/modules/Contacts/Ext/Language/en_us.new_link.php\nContent:\n$mod_strings['LBL_ACTIVE_OTHER_INVITES'] = 'Your New Link'; 5. Quick Repair and Rebuild That should hopefully get you started. Keep an eye on the sugarlogs while you’re debugging your queries. I also found using xdebug and SugarQueries compileSql function invaluable in figuring out what I needed to do to get a working INNER JOIN statement.\nI’ve found this to be a surprisingly powerful solution, it means that if you need to show information related to a module that might be a few joins away, this allows you to create the links manually without having to create pointless related fields in-between the two.\n","wordCount":"662","inLanguage":"en","datePublished":"2014-08-13T00:00:00Z","dateModified":"2014-08-13T00:00:00Z","author":{"@type":"Person","name":"Shane Dowling"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://shanedowling.com/posts/sugarcrm-7-custom-subpanels-a75e66374a5b/"},"publisher":{"@type":"Organization","name":"Shane Dowling","logo":{"@type":"ImageObject","url":"https://shanedowling.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://shanedowling.com/ accesskey=h title="Shane Dowling (Alt + H)">Shane Dowling</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://shanedowling.com/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://shanedowling.com/categories/ title=Categories><span>Categories</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">SugarCRM 7 — Custom subpanels</h1><div class=post-meta><span title='2014-08-13 00:00:00 +0000 UTC'>August 13, 2014</span>&nbsp;·&nbsp;Shane Dowling</div></header><div class=post-content><p><img loading=lazy src=/images/1__g70Q0ojQdUFPYP4a__sPE5w.png></p><p>This tutorial should hopefully help you to create a new subpanel under
the Contacts module in Sugar using a custom link class and driven by
SugarCRM 7&rsquo;s new SugarQuery API.</p><h3 id=1-create-a-new-link-class>1. Create a new link class<a hidden class=anchor aria-hidden=true href=#1-create-a-new-link-class>#</a></h3><p>This should go into custom/modules//YourNewLink.php and this
class will act as the custom functionality that will build your link
between the two records.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#e6db74>/**
</span></span></span><span style=display:flex><span><span style=color:#e6db74> * Custom filtered link
</span></span></span><span style=display:flex><span><span style=color:#e6db74> */</span>
</span></span><span style=display:flex><span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>YourNewLink</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Link2</span>
</span></span><span style=display:flex><span> {
</span></span><span style=display:flex><span> <span style=color:#e6db74>/**
</span></span></span><span style=display:flex><span><span style=color:#e6db74> * DB
</span></span></span><span style=display:flex><span><span style=color:#e6db74> *
</span></span></span><span style=display:flex><span><span style=color:#e6db74> * @var DBManager
</span></span></span><span style=display:flex><span><span style=color:#e6db74> */</span>
</span></span><span style=display:flex><span> <span style=color:#66d9ef>protected</span> $db;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> __construct($linkName, $bean, $linkDef <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>)
</span></span><span style=display:flex><span> {
</span></span><span style=display:flex><span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>focus</span> <span style=color:#f92672>=</span> $bean;
</span></span><span style=display:flex><span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>name</span> <span style=color:#f92672>=</span> $linkName;
</span></span><span style=display:flex><span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>db</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>DBManagerFactory</span><span style=color:#f92672>::</span><span style=color:#a6e22e>getInstance</span>();
</span></span><span style=display:flex><span> <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>empty</span>($linkDef)) {
</span></span><span style=display:flex><span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>def</span> <span style=color:#f92672>=</span> $bean<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>field_defs</span>[$linkName];
</span></span><span style=display:flex><span> } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>def</span> <span style=color:#f92672>=</span> $linkDef;
</span></span><span style=display:flex><span> }
</span></span><span style=display:flex><span> }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e6db74>/**
</span></span></span><span style=display:flex><span><span style=color:#e6db74> * Returns false if no relationship was found for this link
</span></span></span><span style=display:flex><span><span style=color:#e6db74> *
</span></span></span><span style=display:flex><span><span style=color:#e6db74> * @return bool
</span></span></span><span style=display:flex><span><span style=color:#e6db74> */</span>
</span></span><span style=display:flex><span> <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>loadedSuccesfully</span>()
</span></span><span style=display:flex><span> {
</span></span><span style=display:flex><span> <span style=color:#75715e>// this link always loads successfully
</span></span></span><span style=display:flex><span><span style=color:#75715e></span> <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span> }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e6db74>/**
</span></span></span><span style=display:flex><span><span style=color:#e6db74> * @see Link2::getRelatedModuleName()
</span></span></span><span style=display:flex><span><span style=color:#e6db74> */</span>
</span></span><span style=display:flex><span> <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getRelatedModuleName</span>()
</span></span><span style=display:flex><span> {
</span></span><span style=display:flex><span> <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#39;&#39;</span>;
</span></span><span style=display:flex><span> }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e6db74>/**
</span></span></span><span style=display:flex><span><span style=color:#e6db74> *
</span></span></span><span style=display:flex><span><span style=color:#e6db74> * @see Link2::buildJoinSugarQuery()
</span></span></span><span style=display:flex><span><span style=color:#e6db74> */</span>
</span></span><span style=display:flex><span> <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>buildJoinSugarQuery</span>($sugar_query, $options <span style=color:#f92672>=</span> <span style=color:#66d9ef>array</span>())
</span></span><span style=display:flex><span> {
</span></span><span style=display:flex><span> $joinParams <span style=color:#f92672>=</span> <span style=color:#66d9ef>array</span>(<span style=color:#e6db74>&#39;joinType&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>isset</span>($options[<span style=color:#e6db74>&#39;joinType&#39;</span>]) <span style=color:#f92672>?</span> $options[<span style=color:#e6db74>&#39;joinType&#39;</span>] <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;INNER&#39;</span>);
</span></span><span style=display:flex><span> $jta <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;active_other_invites&#39;</span>;
</span></span><span style=display:flex><span> <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#66d9ef>empty</span>($options[<span style=color:#e6db74>&#39;joinTableAlias&#39;</span>])) {
</span></span><span style=display:flex><span> $jta <span style=color:#f92672>=</span> $joinParams[<span style=color:#e6db74>&#39;alias&#39;</span>] <span style=color:#f92672>=</span> $options[<span style=color:#e6db74>&#39;joinTableAlias&#39;</span>];
</span></span><span style=display:flex><span> }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$sugar_query<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>joinRaw</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getCustomJoin</span>($options), $joinParams);
</span></span><span style=display:flex><span> <span style=color:#66d9ef>return</span> $sugar_query<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>join</span>[$jta];
</span></span><span style=display:flex><span> }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e6db74>/**
</span></span></span><span style=display:flex><span><span style=color:#e6db74> * Builds main join subpanel
</span></span></span><span style=display:flex><span><span style=color:#e6db74> * @param string $params
</span></span></span><span style=display:flex><span><span style=color:#e6db74> * @return string JOIN clause
</span></span></span><span style=display:flex><span><span style=color:#e6db74> */</span>
</span></span><span style=display:flex><span> <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getCustomJoin</span>($params <span style=color:#f92672>=</span> <span style=color:#66d9ef>array</span>())
</span></span><span style=display:flex><span> {
</span></span><span style=display:flex><span> $bean_id <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>db</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>quoted</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>focus</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>id</span>);
</span></span><span style=display:flex><span> $sql <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34; INNER JOIN(&#34;</span>;
</span></span><span style=display:flex><span> $sql <span style=color:#f92672>.=</span> <span style=color:#e6db74>&#34;SELECT id FROM accounts WHERE id=</span><span style=color:#e6db74>{</span>$bean_id<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>; <span style=color:#75715e>// This is essentially a select statement that will return a set of ids that you can match with the existing sugar_query
</span></span></span><span style=display:flex><span><span style=color:#75715e></span> $sql <span style=color:#f92672>.=</span> <span style=color:#e6db74>&#34;) accounts_result ON accounts_result.id = sugar_query_table.id&#34;</span>;
</span></span><span style=display:flex><span> <span style=color:#66d9ef>return</span> $sql;
</span></span><span style=display:flex><span> }
</span></span><span style=display:flex><span> }
</span></span></code></pre></div><p>The argument $sugar_query is a new SugarQuery object, the details of
which are documented <a href=http://developer.sugarcrm.com/2014/04/22/sugarcrm-cookbook-sugarquery-the-basics/>here</a>.
What you essentially need to do is extend this query with whatever
join/filters you wish to add. This is done in the inner join I&rsquo;ve
specified.</p><p><strong>Note:</strong> The inner join can get really complicated, so if you want a
real working example, checkout modules/Emails/ArchivedEmailsLink.php and
how the core sugar team use this. I can confirm however that this does
work with custom joins.</p><p>Here is the getEmailsJoin to help you understand what you can actually
produce via this custom join.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#e6db74>/**
</span></span></span><span style=display:flex><span><span style=color:#e6db74> * Builds main join for archived emails
</span></span></span><span style=display:flex><span><span style=color:#e6db74> * @param string $params
</span></span></span><span style=display:flex><span><span style=color:#e6db74> * @return string JOIN clause
</span></span></span><span style=display:flex><span><span style=color:#e6db74> */</span>
</span></span><span style=display:flex><span> <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getEmailsJoin</span>($params <span style=color:#f92672>=</span> <span style=color:#66d9ef>array</span>())
</span></span><span style=display:flex><span> {
</span></span><span style=display:flex><span> $bean_id <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>db</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>quoted</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>focus</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>id</span>);
</span></span><span style=display:flex><span> <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#66d9ef>empty</span>($params[<span style=color:#e6db74>&#39;join_table_alias&#39;</span>])) {
</span></span><span style=display:flex><span> $table_name <span style=color:#f92672>=</span> $params[<span style=color:#e6db74>&#39;join_table_alias&#39;</span>];
</span></span><span style=display:flex><span> } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span> $table_name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;emails&#39;</span>;
</span></span><span style=display:flex><span> }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;INNER JOIN (</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>n&#34;</span><span style=color:#f92672>.</span>
</span></span><span style=display:flex><span> <span style=color:#75715e>// directly assigned emails
</span></span></span><span style=display:flex><span><span style=color:#75715e></span> <span style=color:#e6db74>&#34;select eb.email_id, &#39;direct&#39; source FROM emails_beans eb where eb.bean_module = &#39;</span><span style=color:#e6db74>{</span>$this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>focus</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>module_dir</span><span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74> AND eb.bean_id = </span><span style=color:#e6db74>$bean_id</span><span style=color:#e6db74> AND eb.deleted=0</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>n&#34;</span> <span style=color:#f92672>.</span>
</span></span><span style=display:flex><span> <span style=color:#e6db74>&#34; UNION &#34;</span><span style=color:#f92672>.</span>
</span></span><span style=display:flex><span> <span style=color:#75715e>// Related by directly by email
</span></span></span><span style=display:flex><span><span style=color:#75715e></span> <span style=color:#e6db74>&#34;select DISTINCT eear.email_id, &#39;relate&#39; source from emails_email_addr_rel eear INNER JOIN email_addr_bean_rel eabr
</span></span></span><span style=display:flex><span><span style=color:#e6db74> ON eabr.bean_id = </span><span style=color:#e6db74>$bean_id</span><span style=color:#e6db74> AND eabr.bean_module = &#39;</span><span style=color:#e6db74>{</span>$this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>focus</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>module_dir</span><span style=color:#e6db74>}</span><span style=color:#e6db74>&#39; AND
</span></span></span><span style=display:flex><span><span style=color:#e6db74> eabr.email_address_id = eear.email_address_id and eabr.deleted=0 where eear.deleted=0</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>n&#34;</span> <span style=color:#f92672>.</span>
</span></span><span style=display:flex><span> <span style=color:#e6db74>&#34;) email_ids ON </span><span style=color:#e6db74>$table_name</span><span style=color:#e6db74>.id=email_ids.email_id &#34;</span>;
</span></span><span style=display:flex><span> }
</span></span></code></pre></div><h3 id=2-add-a-new-vardef-entry-for-the-linkfield>2. Add a new vardef entry for the linkfield.<a hidden class=anchor aria-hidden=true href=#2-add-a-new-vardef-entry-for-the-linkfield>#</a></h3><p>For this example, I&rsquo;m going to create the custom link on the contacts
module. So this code goes in
custom/Extension/modules/Contacts/Ext/Vardefs/your_field_name.php</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span>$dictionary[<span style=color:#e6db74>&#34;Contact&#34;</span>][<span style=color:#e6db74>&#34;fields&#34;</span>][<span style=color:#e6db74>&#34;your_field_name&#34;</span>] <span style=color:#f92672>=</span> <span style=color:#66d9ef>array</span>(
</span></span><span style=display:flex><span> <span style=color:#e6db74>&#39;name&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;active_other_invites&#39;</span>,
</span></span><span style=display:flex><span> <span style=color:#e6db74>&#39;type&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;link&#39;</span>,
</span></span><span style=display:flex><span> <span style=color:#e6db74>&#39;link_file&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;custom/modules//YourNewLink.php&#39;</span>,
</span></span><span style=display:flex><span> <span style=color:#e6db74>&#39;link_class&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;YourNewLink&#39;</span>,
</span></span><span style=display:flex><span> <span style=color:#e6db74>&#39;source&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;non-db&#39;</span>,
</span></span><span style=display:flex><span> <span style=color:#e6db74>&#39;vname&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;LBL_NEW_LINK&#39;</span>,
</span></span><span style=display:flex><span> <span style=color:#e6db74>&#39;module&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;&#39;</span>,
</span></span><span style=display:flex><span> <span style=color:#e6db74>&#39;link_type&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;many&#39;</span>,
</span></span><span style=display:flex><span> <span style=color:#e6db74>&#39;relationship&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;&#39;</span>,
</span></span><span style=display:flex><span> );
</span></span></code></pre></div><h3 id=3-add-the-new-link-as-a-subpanel>3. Add the new link as a subpanel<a hidden class=anchor aria-hidden=true href=#3-add-the-new-link-as-a-subpanel>#</a></h3><p>custom/Extension/modules/Contacts/Ext/clients/base/layouts/subpanels/your_subpanel_name.php</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span>$viewdefs[<span style=color:#e6db74>&#39;Contacts&#39;</span>][<span style=color:#e6db74>&#39;base&#39;</span>][<span style=color:#e6db74>&#39;layout&#39;</span>][<span style=color:#e6db74>&#39;subpanels&#39;</span>][<span style=color:#e6db74>&#39;components&#39;</span>][] <span style=color:#f92672>=</span> <span style=color:#66d9ef>array</span> (
</span></span><span style=display:flex><span> <span style=color:#e6db74>&#39;layout&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;subpanel&#39;</span>,
</span></span><span style=display:flex><span> <span style=color:#e6db74>&#39;label&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;LBL_NEW_LINK&#39;</span>,
</span></span><span style=display:flex><span> <span style=color:#e6db74>&#39;context&#39;</span> <span style=color:#f92672>=&gt;</span>
</span></span><span style=display:flex><span> <span style=color:#66d9ef>array</span> (
</span></span><span style=display:flex><span> <span style=color:#e6db74>&#39;link&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;your_field_name&#39;</span>,
</span></span><span style=display:flex><span> ),
</span></span><span style=display:flex><span> );
</span></span></code></pre></div><h3 id=4-add-the-label>4. Add the label<a hidden class=anchor aria-hidden=true href=#4-add-the-label>#</a></h3><p>custom/Extension/modules/Contacts/Ext/Language/en_us.new_link.php</p><p>Content:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span>$mod_strings[<span style=color:#e6db74>&#39;LBL_ACTIVE_OTHER_INVITES&#39;</span>] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;Your New Link&#39;</span>;
</span></span></code></pre></div><h3 id=5-quick-repair-and-rebuild>5. Quick Repair and Rebuild<a hidden class=anchor aria-hidden=true href=#5-quick-repair-and-rebuild>#</a></h3><p>That should hopefully get you started. Keep an eye on the sugarlogs
while you&rsquo;re debugging your queries. I also found using xdebug and
SugarQueries compileSql function invaluable in figuring out what I
needed to do to get a working INNER JOIN statement.</p><p>I&rsquo;ve found this to be a surprisingly powerful solution, it means that if
you need to show information related to a module that might be a few
joins away, this allows you to create the links manually without having
to create pointless related fields in-between the two.</p></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy; 2026 <a href=https://shanedowling.com/>Shane Dowling</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>