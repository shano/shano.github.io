<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Better local development for Serverless Functions | Shane Dowling</title>
<meta name=keywords content><meta name=description content="
Lambda is a terrific piece of kit for all the benefits listed on the AWS product page and Serverless is a very useful framework for developing Lambda functions. However, developing serverless applications locally is a total pain if what you&rsquo;re solving isn&rsquo;t totally trivial.
When things get complicated and your Lambda functions start to integrate with other AWS services, things really begin to break down. There are a few things that look like silver-bullets, I&rsquo;ll share them here and explain why they didn&rsquo;t work for me, then give you a working example that I myself struggled to find(hence me writing this)."><meta name=author content="Shane Dowling"><link rel=canonical href=https://shanedowling.com/posts/better-local-development-for-serverless-functions-b96b5a4cfa8f/><link crossorigin=anonymous href=/assets/css/stylesheet.2211ca3164be7830024f6aad2b3a2e520843a64f8f048445c3401c1249aa051d.css integrity="sha256-IhHKMWS+eDACT2qtKzouUghDpk+PBIRFw0AcEkmqBR0=" rel="preload stylesheet" as=style><link rel=icon href=https://shanedowling.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://shanedowling.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://shanedowling.com/favicon-32x32.png><link rel=apple-touch-icon href=https://shanedowling.com/apple-touch-icon.png><link rel=mask-icon href=https://shanedowling.com/favicon.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://shanedowling.com/posts/better-local-development-for-serverless-functions-b96b5a4cfa8f/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script src=https://brightpin.com/script.js data-site=f93d4c22-b475-476d-8d86-8ec34fffe005 data-endpoint=https://brightpin.com/collect async></script><meta property="og:url" content="https://shanedowling.com/posts/better-local-development-for-serverless-functions-b96b5a4cfa8f/"><meta property="og:site_name" content="Shane Dowling"><meta property="og:title" content="Better local development for Serverless Functions"><meta property="og:description" content="
Lambda is a terrific piece of kit for all the benefits listed on the AWS product page and Serverless is a very useful framework for developing Lambda functions. However, developing serverless applications locally is a total pain if what you’re solving isn’t totally trivial.
When things get complicated and your Lambda functions start to integrate with other AWS services, things really begin to break down. There are a few things that look like silver-bullets, I’ll share them here and explain why they didn’t work for me, then give you a working example that I myself struggled to find(hence me writing this)."><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-02-11T20:15:38+00:00"><meta property="article:modified_time" content="2019-02-11T20:15:38+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Better local development for Serverless Functions"><meta name=twitter:description content="
Lambda is a terrific piece of kit for all the benefits listed on the AWS product page and Serverless is a very useful framework for developing Lambda functions. However, developing serverless applications locally is a total pain if what you&rsquo;re solving isn&rsquo;t totally trivial.
When things get complicated and your Lambda functions start to integrate with other AWS services, things really begin to break down. There are a few things that look like silver-bullets, I&rsquo;ll share them here and explain why they didn&rsquo;t work for me, then give you a working example that I myself struggled to find(hence me writing this)."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://shanedowling.com/posts/"},{"@type":"ListItem","position":2,"name":"Better local development for Serverless Functions","item":"https://shanedowling.com/posts/better-local-development-for-serverless-functions-b96b5a4cfa8f/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Better local development for Serverless Functions","name":"Better local development for Serverless Functions","description":"\nLambda is a terrific piece of kit for all the benefits listed on the AWS product page and Serverless is a very useful framework for developing Lambda functions. However, developing serverless applications locally is a total pain if what you\u0026rsquo;re solving isn\u0026rsquo;t totally trivial.\nWhen things get complicated and your Lambda functions start to integrate with other AWS services, things really begin to break down. There are a few things that look like silver-bullets, I\u0026rsquo;ll share them here and explain why they didn\u0026rsquo;t work for me, then give you a working example that I myself struggled to find(hence me writing this).\n","keywords":[],"articleBody":"\nLambda is a terrific piece of kit for all the benefits listed on the AWS product page and Serverless is a very useful framework for developing Lambda functions. However, developing serverless applications locally is a total pain if what you’re solving isn’t totally trivial.\nWhen things get complicated and your Lambda functions start to integrate with other AWS services, things really begin to break down. There are a few things that look like silver-bullets, I’ll share them here and explain why they didn’t work for me, then give you a working example that I myself struggled to find(hence me writing this).\nLocalstack Localstack is definitely the biggest attempt at a silver bullet here. Basically it emulates a huge chunk of AWS locally and you connect your serverless functions into that. Why I didn’t use it:\nBits worked, but if you have any sort of half complicated setup(like a region outside us-east-1 or eu-west-1), it will break down. Uploading a whole cloudformation template was a disaster of broken links between services. I got to the point of editing localstack code to try fix issue after issue I was coming across and gave up. The product would be cool if it wasn’t trying to do something so super complicated. It’s also a huge resource drain on a developer’s machine. Fundamentally, you shouldn’t have to emulate half of AWS to test your code. Serverless Offline Serverless offline is fairly straightforward. It should allow you to spin up your functions locally and call them as needed. Where this fell down for me was that it required you to have HTTP endpoints for your lambda functions, all of our Lambda functions were driven either by SQS events or a Cron. We also instantiate our SNS topics in our code, so it would constantly attempt to create SNS topics and AWS would throw errors.\nI also did try using serverless-offline-sqs but could not get it to drive events into our Lamdba functions.\nI was burning a lot of time getting a dev environment setup and I realised that this was fundamentally the wrong approach. I needed to start writing proper unit tests and use mocking to emulate the infrastructure(I mean ideally they’d be isolated properly and infrastructure/functions would be totally ignorant of each other, but that’s for another day).\nThe Example Say we’re developing an application that makes use of:\nLambda MongoDB SQS SNS Your lambda function connects to your MongoDB, does a thing and fires off occasional SNS notifications/SQS messages to other services.\nLambda\nFor the actual code being run, I was going to use jest to start writing tests. Jest works well and integrates nicely into serverless.\nMongoDB\nTo emulate MongoDB, I’m going to use an in-memory version of MongoDB that ties nicely into our Mongoose models.\nSQS/SNS\nFor any Amazon infrastructure, we’re going to use aws-sdk-mock. This is an excellent wrapper around sinon for mocking the AWS infrastructure, that’s super useful for unit tests as you’ll see later.\nTieing it all together So firstly lets install our dependencies.\nnpm install aws-sdk-mock mongodb-memory-server sinon jest --save-dev\nLet’s also create a tests folder to keep all this test code in.\nmkdir tests\nSetting up MongoDB\nNow, for our code to integrate with our in-memory Mongo-DB server, we’re going to need to add a few setup/teardown functions and a Mongo Environment. Clone this repo and put:\nsetup.js teardown.js mongo-environment.js into your new test folder.\nIn your root directory add a jest.config.js with this content.\nmodule.exports = { globalSetup: './tests/setup.js', globalTeardown: './tests/teardown.js', testEnvironment: './tests/mongo-environment.js', roots: ['./tests/'], }; This should be enough to get MongoDB up and running. Now onto our actual tests scripts.\nSetting up our tests\nNow, finally, you can tie it all together with this snippet:\nAdd jest to your package.json\n\"scripts\":{ \"test\": \"jest\" }, And run with npm test.\nOne major point to note is that aws-mock-sdk requires a very specific way of instantiating AWS resources(within the scope of the function tests), so if you see any errors around aws regions, double check you’re following the rules.\n","wordCount":"673","inLanguage":"en","datePublished":"2019-02-11T20:15:38.791Z","dateModified":"2019-02-11T20:15:38.791Z","author":{"@type":"Person","name":"Shane Dowling"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://shanedowling.com/posts/better-local-development-for-serverless-functions-b96b5a4cfa8f/"},"publisher":{"@type":"Organization","name":"Shane Dowling","logo":{"@type":"ImageObject","url":"https://shanedowling.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://shanedowling.com/ accesskey=h title="Shane Dowling (Alt + H)">Shane Dowling</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://shanedowling.com/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://shanedowling.com/categories/ title=Categories><span>Categories</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Better local development for Serverless Functions</h1><div class=post-meta><span title='2019-02-11 20:15:38.791 +0000 UTC'>February 11, 2019</span>&nbsp;·&nbsp;Shane Dowling</div></header><div class=post-content><p><img loading=lazy src=/images/1__roedigbmFjRYkZobdZWuKg.jpeg></p><p>Lambda is a terrific piece of kit for all the benefits listed on the <a href=https://aws.amazon.com/lambda/>AWS product page</a> and <a href=https://serverless.com/>Serverless</a> is a very useful framework for developing Lambda functions. However, developing serverless applications locally is a total pain if what you&rsquo;re solving isn&rsquo;t totally trivial.</p><p>When things get complicated and your Lambda functions start to integrate with other AWS services, things really begin to break down. There are a few things that look like silver-bullets, I&rsquo;ll share them here and explain why they didn&rsquo;t work for me, then give you a working example that I myself struggled to find(hence me writing this).</p><h3 id=localstack>Localstack<a hidden class=anchor aria-hidden=true href=#localstack>#</a></h3><p><a href=https://github.com/localstack/localstack>Localstack</a> is definitely the biggest attempt at a silver bullet here. Basically it emulates a huge chunk of AWS locally and you connect your serverless functions into that. Why I didn&rsquo;t use it:</p><ol><li>Bits worked, but if you have any sort of half complicated setup(like a region outside us-east-1 or eu-west-1), it will break down. Uploading a whole cloudformation template was a disaster of broken links between services. I got to the point of editing localstack code to try fix issue after issue I was coming across and gave up. The product would be cool if it wasn&rsquo;t trying to do something so super complicated.</li><li>It&rsquo;s also a huge resource drain on a developer&rsquo;s machine.</li><li>Fundamentally, you shouldn&rsquo;t have to emulate half of AWS to test your code.</li></ol><h3 id=serverless-offline>Serverless Offline<a hidden class=anchor aria-hidden=true href=#serverless-offline>#</a></h3><p>Serverless offline is fairly straightforward. It should allow you to spin up your functions locally and call them as needed. Where this fell down for me was that it required you to have HTTP endpoints for your lambda functions, all of our Lambda functions were driven either by SQS events or a Cron. We also instantiate our SNS topics in our code, so it would constantly attempt to create SNS topics and AWS would throw errors.</p><p>I also did try using <a href=https://www.npmjs.com/package/serverless-offline-sqs>serverless-offline-sqs</a> but could not get it to drive events into our Lamdba functions.</p><p>I was burning a lot of time getting a dev environment setup and I realised that this was fundamentally the wrong approach. I needed to start writing proper unit tests and use mocking to emulate the infrastructure(I mean ideally they&rsquo;d be isolated properly and infrastructure/functions would be totally ignorant of each other, but that&rsquo;s for another day).</p><h3 id=the-example>The Example<a hidden class=anchor aria-hidden=true href=#the-example>#</a></h3><p>Say we&rsquo;re developing an application that makes use of:</p><ul><li>Lambda</li><li>MongoDB</li><li>SQS</li><li>SNS</li></ul><p>Your lambda function connects to your MongoDB, does a thing and fires off occasional SNS notifications/SQS messages to other services.</p><p><strong>Lambda</strong></p><p>For the actual code being run, I was going to use <a href=https://www.npmjs.com/package/jest>jest</a> to start writing tests. Jest works well and integrates nicely into serverless.</p><p><strong>MongoDB</strong></p><p>To emulate MongoDB, I&rsquo;m going to use an <a href=https://www.npmjs.com/package/mongodb-memory-server>in-memory version of MongoDB</a> that ties nicely into our Mongoose models.</p><p><strong>SQS/SNS</strong></p><p>For any Amazon infrastructure, we&rsquo;re going to use <a href=https://www.npmjs.com/package/aws-sdk-mock>aws-sdk-mock</a>. This is an excellent wrapper around <a href=https://www.npmjs.com/package/sinon>sinon</a> for mocking the AWS infrastructure, that&rsquo;s super useful for unit tests as you&rsquo;ll see later.</p><h3 id=tieing-it-all-together>Tieing it all together<a hidden class=anchor aria-hidden=true href=#tieing-it-all-together>#</a></h3><p>So firstly lets install our dependencies.</p><p><code>npm install aws-sdk-mock mongodb-memory-server sinon jest --save-dev</code></p><p>Let&rsquo;s also create a tests folder to keep all this test code in.</p><p>mkdir tests</p><p><strong>Setting up MongoDB</strong></p><p>Now, for our code to integrate with our in-memory Mongo-DB server, we&rsquo;re going to need to add a few setup/teardown functions and a Mongo Environment. Clone this <a href=https://github.com/vladgolubev/jest-mongodb>repo</a> and put:</p><ul><li><code>setup.js</code></li><li><code>teardown.js</code></li><li><code>mongo-environment.js</code></li></ul><p>into your new test folder.</p><p>In your root directory add a <code>jest.config.js</code> with this content.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>module</span>.<span style=color:#a6e22e>exports</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>globalSetup</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;./tests/setup.js&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>globalTeardown</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;./tests/teardown.js&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>testEnvironment</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;./tests/mongo-environment.js&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>roots</span><span style=color:#f92672>:</span> [<span style=color:#e6db74>&#39;./tests/&#39;</span>],
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>This should be enough to get MongoDB up and running. Now onto our actual tests scripts.</p><p><strong>Setting up our tests</strong></p><p>Now, finally, you can tie it all together with this snippet:</p><p>Add jest to your package.json</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#e6db74>&#34;scripts&#34;</span><span style=color:#960050;background-color:#1e0010>:</span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;test&#34;</span>: <span style=color:#e6db74>&#34;jest&#34;</span>
</span></span><span style=display:flex><span>}<span style=color:#960050;background-color:#1e0010>,</span>
</span></span></code></pre></div><p>And run with <code>npm test</code>.</p><p>One major point to note is that aws-mock-sdk requires a very specific way of instantiating AWS resources(within the scope of the function tests), so if you see any errors around aws regions, double check <a href=https://github.com/dwyl/aws-sdk-mock#use-in-your-tests>you&rsquo;re following the rules</a>.</p></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy; 2026 <a href=https://shanedowling.com/>Shane Dowling</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>