<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Fixing a broken vagrant box | Shane Dowling</title><meta name=keywords content><meta name=description content="
The first time this happened I went into a cold sweat. My box with all
dev versions of my companies live databases had died. Of course I had
the box provisioned with salt so configuration wasn&rsquo;t a problem, but
grabbing all those databases, downloading, altering specific internal
values and inserting them was going to cost me hours. These steps
should&rsquo;ve been salted too but I hadn&rsquo;t gotten round to it yet."><meta name=author content="Shane Dowling"><link rel=canonical href=https://shanedowling.com/posts/2013-10-17_fixing-a-broken-vagrant-box-cd6f169a62eb/><link crossorigin=anonymous href=/assets/css/stylesheet.8fe10233a706bc87f2e08b3cf97b8bd4c0a80f10675a143675d59212121037c0.css integrity="sha256-j+ECM6cGvIfy4Is8+XuL1MCoDxBnWhQ2ddWSEhIQN8A=" rel="preload stylesheet" as=style><link rel=icon href=https://shanedowling.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://shanedowling.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://shanedowling.com/favicon-32x32.png><link rel=apple-touch-icon href=https://shanedowling.com/apple-touch-icon.png><link rel=mask-icon href=https://shanedowling.com/favicon.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://shanedowling.com/posts/2013-10-17_fixing-a-broken-vagrant-box-cd6f169a62eb/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://shanedowling.com/posts/2013-10-17_fixing-a-broken-vagrant-box-cd6f169a62eb/"><meta property="og:site_name" content="Shane Dowling"><meta property="og:title" content="Fixing a broken vagrant box"><meta property="og:description" content="
The first time this happened I went into a cold sweat. My box with all dev versions of my companies live databases had died. Of course I had the box provisioned with salt so configuration wasn’t a problem, but grabbing all those databases, downloading, altering specific internal values and inserting them was going to cost me hours. These steps should’ve been salted too but I hadn’t gotten round to it yet."><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2013-10-17T00:00:00+00:00"><meta property="article:modified_time" content="2013-10-17T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Fixing a broken vagrant box"><meta name=twitter:description content="
The first time this happened I went into a cold sweat. My box with all
dev versions of my companies live databases had died. Of course I had
the box provisioned with salt so configuration wasn&rsquo;t a problem, but
grabbing all those databases, downloading, altering specific internal
values and inserting them was going to cost me hours. These steps
should&rsquo;ve been salted too but I hadn&rsquo;t gotten round to it yet."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://shanedowling.com/posts/"},{"@type":"ListItem","position":2,"name":"Fixing a broken vagrant box","item":"https://shanedowling.com/posts/2013-10-17_fixing-a-broken-vagrant-box-cd6f169a62eb/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Fixing a broken vagrant box","name":"Fixing a broken vagrant box","description":"\nThe first time this happened I went into a cold sweat. My box with all dev versions of my companies live databases had died. Of course I had the box provisioned with salt so configuration wasn\u0026rsquo;t a problem, but grabbing all those databases, downloading, altering specific internal values and inserting them was going to cost me hours. These steps should\u0026rsquo;ve been salted too but I hadn\u0026rsquo;t gotten round to it yet.\n","keywords":[],"articleBody":"\nThe first time this happened I went into a cold sweat. My box with all dev versions of my companies live databases had died. Of course I had the box provisioned with salt so configuration wasn’t a problem, but grabbing all those databases, downloading, altering specific internal values and inserting them was going to cost me hours. These steps should’ve been salted too but I hadn’t gotten round to it yet.\nWhen I brought my vagrant box up, vagrant kept thinking that my original box had gone and kept trying to re-create a new one and provisioning it. Instead of starting from scratch I dug down and tried to figure out the problem. This issue has happened on several occasions for me so I figured I’d document the steps to fix it. Start up virtualbox and make sure the box is still there and working. Sometimes I find that the .vbox file can get corrupted. This sucks but go into the folder that contains the vbox file and see if there’s a VM_NAME.vbox-prev and copy that back to VM_NAME.vbox and try to run it just via virtualbox to see if it picks back up. This was always my issue, I believe because my laptop sometimes ran out of space and virtualbox tries to write a new file it can’t and simply writes something corrupted. Make sure Vagrant points to your working VirtualMachine\nWhile trying to get vagrant up and running again it may have create a bunch of similar boxes, get rid of those and retain the box you want to keep. Run this VBoxManage list vms and get the GUID of your newly fixed box. From the vagrant box directory go to .vagrant/machines/default/virtualbox and replace the contents of this file with just the GUID. Make sure no newline exists at the end of this file. This is key. A lot of editors will automatically add a newline here and won’t present it when you attempt to delete the newline. Try diffing this id file with the id file from another vagrant box to see if the newline still appears. Otherwise, vim will also state noeol in it’s statusbar to confirm there is no end of line. Run vagrant status and see if it picks up your old box, if it doesn’t make sure step 4 is correct. Test your VM\nMake sure none of the other VMs are still running. I use the vagrant list plugin for this. Once installed run vagrant list. Then I shut down any that might conflict with my VM using VBoxManage controlvm VM_NAME poweroff Then vagrant reload my vagrant box to ensure everything works. ","wordCount":"440","inLanguage":"en","datePublished":"2013-10-17T00:00:00Z","dateModified":"2013-10-17T00:00:00Z","author":{"@type":"Person","name":"Shane Dowling"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://shanedowling.com/posts/2013-10-17_fixing-a-broken-vagrant-box-cd6f169a62eb/"},"publisher":{"@type":"Organization","name":"Shane Dowling","logo":{"@type":"ImageObject","url":"https://shanedowling.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://shanedowling.com/ accesskey=h title="Shane Dowling (Alt + H)">Shane Dowling</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://shanedowling.com/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://shanedowling.com/categories/ title=Categories><span>Categories</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Fixing a broken vagrant box</h1><div class=post-meta><span title='2013-10-17 00:00:00 +0000 UTC'>October 17, 2013</span>&nbsp;·&nbsp;Shane Dowling</div></header><div class=post-content><p><img loading=lazy src=/1__TalXSpVG5yo__Lucbr1Wm6w.png></p><p>The first time this happened I went into a cold sweat. My box with all
dev versions of my companies live databases had died. Of course I had
the box provisioned with salt so configuration wasn&rsquo;t a problem, but
grabbing all those databases, downloading, altering specific internal
values and inserting them was going to cost me hours. These steps
should&rsquo;ve been salted too but I hadn&rsquo;t gotten round to it yet.</p><h2 id=figured-id-document-the-steps-to-fix-it>When I brought my vagrant box up, vagrant kept thinking that my original
box had gone and kept trying to re-create a new one and provisioning it.
Instead of starting from scratch I dug down and tried to figure out the
problem. This issue has happened on several occasions for me so I
figured I&rsquo;d document the steps to fix it.</h2><ol><li>Start up virtualbox and make sure the box is still there and working.</li><li>Sometimes I find that the .vbox file can get corrupted. This sucks but go into the folder that contains the vbox file and see if there&rsquo;s a VM_NAME.vbox-prev and copy that back to VM_NAME.vbox and try to run it just via virtualbox to see if it picks back up. This was always my issue, I believe because my laptop sometimes ran out of space and virtualbox tries to write a new file it can&rsquo;t and simply writes something corrupted.</li></ol><p>Make sure Vagrant points to your working VirtualMachine</p><ol><li>While trying to get vagrant up and running again it may have create a bunch of similar boxes, get rid of those and retain the box you want to keep.</li><li>Run this VBoxManage list vms and get the GUID of your newly fixed box.</li><li>From the vagrant box directory go to .vagrant/machines/default/virtualbox and replace the contents of this file with just the GUID. <strong>Make sure no newline exists at the end of this file.</strong> This is key. A lot of editors will automatically add a newline here and won&rsquo;t present it when you attempt to delete the newline. Try diffing this id file with the id file from another vagrant box to see if the newline still appears. Otherwise, vim will also state noeol in it&rsquo;s statusbar to confirm there is no end of line.</li><li>Run vagrant status and see if it picks up your old box, if it doesn&rsquo;t make sure step 4 is correct.</li></ol><p>Test your VM</p><ol><li>Make sure none of the other VMs are still running. I use the <a href=https://github.com/joshmcarthur/vagrant-list>vagrant list plugin</a> for this. Once installed run vagrant list.</li><li>Then I shut down any that might conflict with my VM using VBoxManage controlvm VM_NAME poweroff</li><li>Then vagrant reload my vagrant box to ensure everything works.</li></ol></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://shanedowling.com/>Shane Dowling</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>