<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Simple API Mocking with Guzzle and Charles | Shane Dowling</title>
<meta name=keywords content><meta name=description content="If you&rsquo;ve ever had to try unit test code that&rsquo;s dependent on external
services, you&rsquo;ll know the pain of trying to mock-up fake API requests by
hand. It&rsquo;s painful to setup and painful to maintain, this little
tutorial attempts to make the whole process as easy as possible.
Step 1: Capturing a live set of API requests.
So firstly download and install Charles Web Proxy. Here&rsquo;s a good description of what Charles can do from their site."><meta name=author content="Shane Dowling"><link rel=canonical href=https://shanedowling.com/posts/simple-api-mocking-with-guzzle-and-charles-e5fdabe8b9fd/><link crossorigin=anonymous href=/assets/css/stylesheet.2211ca3164be7830024f6aad2b3a2e520843a64f8f048445c3401c1249aa051d.css integrity="sha256-IhHKMWS+eDACT2qtKzouUghDpk+PBIRFw0AcEkmqBR0=" rel="preload stylesheet" as=style><link rel=icon href=https://shanedowling.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://shanedowling.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://shanedowling.com/favicon-32x32.png><link rel=apple-touch-icon href=https://shanedowling.com/apple-touch-icon.png><link rel=mask-icon href=https://shanedowling.com/favicon.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://shanedowling.com/posts/simple-api-mocking-with-guzzle-and-charles-e5fdabe8b9fd/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script src="https://brightpin.com/script.js?v=1" data-site=f93d4c22-b475-476d-8d86-8ec34fffe005 data-endpoint=https://brightpin.com/collect async></script><meta property="og:url" content="https://shanedowling.com/posts/simple-api-mocking-with-guzzle-and-charles-e5fdabe8b9fd/"><meta property="og:site_name" content="Shane Dowling"><meta property="og:title" content="Simple API Mocking with Guzzle and Charles"><meta property="og:description" content="If you’ve ever had to try unit test code that’s dependent on external services, you’ll know the pain of trying to mock-up fake API requests by hand. It’s painful to setup and painful to maintain, this little tutorial attempts to make the whole process as easy as possible.
Step 1: Capturing a live set of API requests. So firstly download and install Charles Web Proxy. Here’s a good description of what Charles can do from their site."><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2014-06-26T00:00:00+00:00"><meta property="article:modified_time" content="2014-06-26T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Simple API Mocking with Guzzle and Charles"><meta name=twitter:description content="If you&rsquo;ve ever had to try unit test code that&rsquo;s dependent on external
services, you&rsquo;ll know the pain of trying to mock-up fake API requests by
hand. It&rsquo;s painful to setup and painful to maintain, this little
tutorial attempts to make the whole process as easy as possible.
Step 1: Capturing a live set of API requests.
So firstly download and install Charles Web Proxy. Here&rsquo;s a good description of what Charles can do from their site."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://shanedowling.com/posts/"},{"@type":"ListItem","position":2,"name":"Simple API Mocking with Guzzle and Charles","item":"https://shanedowling.com/posts/simple-api-mocking-with-guzzle-and-charles-e5fdabe8b9fd/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Simple API Mocking with Guzzle and Charles","name":"Simple API Mocking with Guzzle and Charles","description":"If you\u0026rsquo;ve ever had to try unit test code that\u0026rsquo;s dependent on external services, you\u0026rsquo;ll know the pain of trying to mock-up fake API requests by hand. It\u0026rsquo;s painful to setup and painful to maintain, this little tutorial attempts to make the whole process as easy as possible.\nStep 1: Capturing a live set of API requests. So firstly download and install Charles Web Proxy. Here\u0026rsquo;s a good description of what Charles can do from their site.\n","keywords":[],"articleBody":"If you’ve ever had to try unit test code that’s dependent on external services, you’ll know the pain of trying to mock-up fake API requests by hand. It’s painful to setup and painful to maintain, this little tutorial attempts to make the whole process as easy as possible.\nStep 1: Capturing a live set of API requests. So firstly download and install Charles Web Proxy. Here’s a good description of what Charles can do from their site.\nCharles is an HTTP proxy / HTTP monitor / Reverse Proxy that enables a developer to view all of the HTTP and SSL / HTTPS traffic between their machine and the Internet. This includes requests, responses and the HTTP headers (which contain the cookies and caching information).\nWe’re going to use Charles to capture an initial set of tests, then save the RAW responses as files that will then be used to supply our mock data to guzzle. So once you got Charles running with a proxy running on port 8888, run an api call like so.\nrequire 'vendor/autoload.php'; use GuzzleHttp\\\\Client; use GuzzleHttp\\\\Subscriber\\\\Mock; $client = new Client([ 'base_url' =\u003e ['https://api.github.com/repos/guzzle/guzzle/commits?per_page=5', []], 'defaults' =\u003e [ 'proxy' =\u003e 'http://localhost:8888' ] ]); $req = $client-\u003eget(); echo $req-\u003egetBody(); When you get a response from this call, view it in Charles under Raw and\nSave this text(including the http headers) as a new file. This is going to be your new mock response that’s going to override Guzzle’s regular response.\nStep 2: Injecting Mock Objects into Guzzle. This is some sample code to do the injection.\nrequire 'vendor/autoload.php'; use GuzzleHttp\\\\Client; use GuzzleHttp\\\\Subscriber\\\\Mock; $client = new Client(); $mock = new Mock(); $mock-\u003eaddResponse(__DIR__.'/mockresponses/your_raw_file'); $client-\u003egetEmitter()-\u003eattach($mock); // This is the key line, attaching the mock file response to your client. $response = $client-\u003eget(); echo $response-\u003egetBody(); Hopefully if you’re using some sort of dependency injection to supply the guzzle library to your client code, you can easily over-ride the client calls with your mock responses by attaching the emitter, then make stable assertions about the state of your client. All of this without any reliance on external services.\n","wordCount":"345","inLanguage":"en","datePublished":"2014-06-26T00:00:00Z","dateModified":"2014-06-26T00:00:00Z","author":{"@type":"Person","name":"Shane Dowling"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://shanedowling.com/posts/simple-api-mocking-with-guzzle-and-charles-e5fdabe8b9fd/"},"publisher":{"@type":"Organization","name":"Shane Dowling","logo":{"@type":"ImageObject","url":"https://shanedowling.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://shanedowling.com/ accesskey=h title="Shane Dowling (Alt + H)">Shane Dowling</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://shanedowling.com/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://shanedowling.com/categories/ title=Categories><span>Categories</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Simple API Mocking with Guzzle and Charles</h1><div class=post-meta><span title='2014-06-26 00:00:00 +0000 UTC'>June 26, 2014</span>&nbsp;·&nbsp;Shane Dowling</div></header><div class=post-content><p>If you&rsquo;ve ever had to try unit test code that&rsquo;s dependent on external
services, you&rsquo;ll know the pain of trying to mock-up fake API requests by
hand. It&rsquo;s painful to setup and painful to maintain, this little
tutorial attempts to make the whole process as easy as possible.</p><h3 id=step-1-capturing-a-live-set-of-api-requests><strong>Step 1:</strong> Capturing a live set of API requests.<a hidden class=anchor aria-hidden=true href=#step-1-capturing-a-live-set-of-api-requests>#</a></h3><p>So firstly download and install <a href=http://www.charlesproxy.com/>Charles Web Proxy</a>. Here&rsquo;s a good description of what Charles can do from their site.</p><p>Charles is an HTTP proxy / HTTP monitor / Reverse Proxy that enables a developer to view all of the HTTP and SSL / HTTPS traffic between their machine and the Internet. This includes requests, responses and the HTTP headers (which contain the cookies and caching information).</p><p>We&rsquo;re going to use Charles to capture an initial set of tests, then save
the RAW responses as files that will then be used to supply our mock
data to guzzle. So once you got Charles running with a proxy running on
port 8888, run an api call like so.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#66d9ef>require</span> <span style=color:#e6db74>&#39;vendor/autoload.php&#39;</span>;
</span></span><span style=display:flex><span> <span style=color:#66d9ef>use</span> <span style=color:#a6e22e>GuzzleHttp\\Client</span>;
</span></span><span style=display:flex><span> <span style=color:#66d9ef>use</span> <span style=color:#a6e22e>GuzzleHttp\\Subscriber\\Mock</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$client <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Client</span>([
</span></span><span style=display:flex><span> <span style=color:#e6db74>&#39;base_url&#39;</span> <span style=color:#f92672>=&gt;</span> [<span style=color:#e6db74>&#39;https://api.github.com/repos/guzzle/guzzle/commits?per_page=5&#39;</span>, []],
</span></span><span style=display:flex><span> <span style=color:#e6db74>&#39;defaults&#39;</span> <span style=color:#f92672>=&gt;</span> [
</span></span><span style=display:flex><span> <span style=color:#e6db74>&#39;proxy&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;http://localhost:8888&#39;</span>
</span></span><span style=display:flex><span> ]
</span></span><span style=display:flex><span> ]);
</span></span><span style=display:flex><span> $req <span style=color:#f92672>=</span> $client<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>get</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>echo</span> $req<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getBody</span>();
</span></span></code></pre></div><p>When you get a response from this call, view it in Charles under Raw and</p><p><img loading=lazy src=/images/1__V4RK2MMCaBvV__euQFzoZvw.png></p><p>Save this text(including the http headers) as a new file. This is going
to be your new mock response that&rsquo;s going to override Guzzle&rsquo;s regular
response.</p><h3 id=step-2-injecting-mock-objects-intoguzzle>Step 2: Injecting Mock Objects into Guzzle.<a hidden class=anchor aria-hidden=true href=#step-2-injecting-mock-objects-intoguzzle>#</a></h3><p>This is some sample code to do the injection.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#66d9ef>require</span> <span style=color:#e6db74>&#39;vendor/autoload.php&#39;</span>;
</span></span><span style=display:flex><span> <span style=color:#66d9ef>use</span> <span style=color:#a6e22e>GuzzleHttp\\Client</span>;
</span></span><span style=display:flex><span> <span style=color:#66d9ef>use</span> <span style=color:#a6e22e>GuzzleHttp\\Subscriber\\Mock</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$client <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Client</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$mock <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Mock</span>();
</span></span><span style=display:flex><span> $mock<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>addResponse</span>(<span style=color:#66d9ef>__DIR__</span><span style=color:#f92672>.</span><span style=color:#e6db74>&#39;/mockresponses/your_raw_file&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$client<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getEmitter</span>()<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>attach</span>($mock); <span style=color:#75715e>// This is the key line, attaching the mock file response to your client.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span> $response <span style=color:#f92672>=</span> $client<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>get</span>();
</span></span><span style=display:flex><span> <span style=color:#66d9ef>echo</span> $response<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getBody</span>();
</span></span></code></pre></div><p>Hopefully if you&rsquo;re using some sort of dependency injection to supply
the guzzle library to your client code, you can easily
over-ride the client calls with your mock responses by attaching the
emitter, then make stable assertions about the state of your client. All
of this without any reliance on external services.</p></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy; 2026 <a href=https://shanedowling.com/>Shane Dowling</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>