<!DOCTYPE html>
<html lang="en">
<head>
        <title>Shane Dowling : Very Simple EC2 Snapshot Management</title>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="./theme/css/main.css" type="text/css" />
        <link href="https://shanedowling.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Shane Dowling ATOM Feed" />

        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="./css/ie.css"/>
                <script src="./js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="./css/ie6.css"/><![endif]-->

</head>

<body>
        
<header>
    <h1><a href="." id="site-title">Shane Dowling </a> :
        <a href="./very-simple-ec2-snapshot-management-6bcca8bd28fb.html" id="page-title">Very Simple EC2 Snapshot Management</a></h1>
<time datetime="2011-04-01T00:00:00+00:00">Fri 01 April 2011</time></header>
<article>
    <p>I've been pulling my hair out trying to get a handy ec2 snapshot
backup/management working. My google results have ranged from broken
libraries to using bash scripts to do one aspect and php scripts to do
another, all of the solutions seem to have serious issues with regions.</p>
<p>Anyway I've coded up a very very stupidly simple bash script that's
based on the ec2-api-tools. Ubuntu based info <a href="https://help.ubuntu.com/community/EC2StartersGuide">here</a>. Essentially sudo apt-get install ec2-api-tools should get the required tools.</p>
<p><strong>What it does:</strong> Backs up all instances and deletes all snapshots older
than 7 days.</p>
<p>You can find it <a href="http://pastebin.com/xMHQUbmH">here</a>, hope it helps.</p>
<p>Due to major problems with ec2-api-tools I've done a quick rewrite for
to support <a href="http://open.eucalyptus.com/wiki/Euca2oolsGuide">euca2ools</a>. Essentially I had this script running on a micro instance and due to bugs with the ubuntu kernel and java it would tank my server so I've switched to the python-based euca2ools.</p>
<p>You can find this script <a href="http://pastebin.com/CCmJyULN">here</a>.</p>
<p>To get euca2ools work simply install via sudo apt-get install euca2ools
and add this to ~/.eucarc</p>
<div class="highlight"><pre><span></span><code><span class="nv">EC2_REGION</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">EC2_REGION</span><span class="k">:-</span><span class="nv">eu</span><span class="p">-west-1</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="nv">EC2_CERT</span><span class="o">=</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/cert.pem

<span class="nv">EC2_PRIVATE_KEY</span><span class="o">=</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/pk.pem

<span class="nv">EC2_ACCESS_KEY</span><span class="o">=</span>AAAAAAAAAAAAAAAAAAA

<span class="nv">EC2_SECRET_KEY</span><span class="o">=</span>+AAAAAAAAAAAAAAaaaaaaaaaaa

<span class="nv">EC2_USER_ID</span><span class="o">=</span><span class="m">1234567890</span>

<span class="nv">EUCALYPTUS_CERT</span><span class="o">=</span>/etc/ec2/amitools/cert-ec2.pem

<span class="nv">EC2_URL</span><span class="o">=</span>https://ec2.<span class="si">${</span><span class="nv">EC2_REGION</span><span class="si">}</span>.amazonaws.com

<span class="nv">S3_URL</span><span class="o">=</span>https://s3.amazonaws.com:443
</code></pre></div>
</article>

        <footer>
            <nav>
                <ul>
                    <li><a href="./pages/contact.html">Contact</a></li>
                    <li>:: <a href="./categories.html">Categories</a></li>
                </ul>
            </nav>
        </footer>

    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
        var pageTracker = _gat._getTracker("UA-9958527-3");
    pageTracker._trackPageview();
    } catch(err) {}</script>
</body>
</html>