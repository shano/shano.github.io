<!DOCTYPE html>
<html lang="en">
<head>
        <title>Shane Dowling : SugarCRM — Add a code-driven column to a list</title>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="./theme/css/main.css" type="text/css" />
        <link href="https://shanedowling.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Shane Dowling ATOM Feed" />

        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="./css/ie.css"/>
                <script src="./js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="./css/ie6.css"/><![endif]-->

</head>

<body>
        
<header>
    <h1><a href="." id="site-title">Shane Dowling </a> :
        <a href="./sugarcrm-add-a-code-driven-column-to-a-list-4e9f4eb672b1.html" id="page-title">SugarCRM — Add a code-driven column to a list</a></h1>
<time datetime="2014-04-05T00:00:00+00:00">Sat 05 April 2014</time></header>
<article>
    <p>Sometimes you might find that you want your users to make decisions based on ListViews and you need to pull in relational data beyond the immediately related objects. Example</p>
<p>So using the circus example say you have performers who are performing for a specific show. You might want to see what other shows those performers are also attached to. If it's typically only one or two shows per event, you can probably make another column in the ListView that displays all shows related to that performer. Lets call this field 'Other Shows'.</p>
<p>What to do
-—-— —</p>
<p>Add your new field in studio before you do anything. So fire up Studio
and create an 'Other Shows' field, create this as a text field.</p>
<p>Alter the newly created fields vardef and set it to non-db.</p>
<p>You can typically find it in
custom/Extension/modules/Performers/Ext/Vardefs/other_shows_c.php.</p>
<div class="highlight"><pre><span></span><code><span class="x">$dictionary[&#39;Performers&#39;][&#39;fields&#39;][&#39;other_shows_c&#39;] = array(</span>
<span class="x"> &#39;name&#39; =&gt; &#39;other_shows_c&#39;,</span>
<span class="x"> &#39;vname&#39; =&gt; &#39;LBL_OTHER_SHOWS_C&#39;,</span>
<span class="x"> &#39;type&#39; =&gt; &#39;varchar&#39;,</span>
<span class="x"> &#39;len&#39; =&gt; &#39;255&#39;,</span>
<span class="x"> &#39;source&#39; =&gt; &#39;non-db&#39;</span>
<span class="x"> );</span>
</code></pre></div>

<p>Ensure the field isn't sortable..</p>
<p>Trying to sort a db/non-db field will cause a bit of trouble and
ListViews don't support it, so just disable it.</p>
<p>Under custom/modules/Performers/metadata/listviewdefs.php change your
newly created fields definition.</p>
<div class="highlight"><pre><span></span><code><span class="x">&#39;OTHER_SHOWS_C&#39; =&gt;</span>
<span class="x"> array (</span>
<span class="x"> &#39;label&#39; =&gt; &#39;Other Shows&#39;,</span>
<span class="x"> &#39;width&#39; =&gt; &#39;10%&#39;,</span>
<span class="x"> &#39;default&#39; =&gt; true,</span>
<span class="x"> &#39;sortable&#39; =&gt; false,</span>
<span class="x"> ),</span>
<span class="x"> ```</span>

<span class="x">Adding the actual code to run.</span>

<span class="x">For this we&#39;re going to leverage SugarCRM&#39;s logic hooks. If you haven&#39;t</span>
<span class="x">already create a logic_hooks.php under custom/modules/Performers/ with</span>
<span class="x">contents like this.</span>

<span class="x">This file essentially defines the hooks you&#39;re going to call. The hook</span>
<span class="x">process_record means it&#39;ll be called for every row that&#39;s displayed on</span>
<span class="x">the ListView.</span>

<span class="x">The performers_logic_hooks_class.php file will be included,</span>
<span class="x">performers_logic_hooks is the class that it will look for and</span>
<span class="x">list_record_process is the function within that class that it will</span>
<span class="x">call.</span>
<span class="x">```php</span>
<span class="x">// Do not store anything in this file that is not part of the array or the hook version. This file will</span>
<span class="x"> // be automatically rebuilt in the future.</span>
<span class="x"> $hook_version = 1;</span>
<span class="x"> $hook_array = Array();</span>
<span class="x"> // position, file, function</span>
<span class="x"> $hook_array[&#39;before_save&#39;] = Array();</span>
<span class="x"> $hook_array[&#39;before_save&#39;][] = Array(1, &#39;workflow&#39;, &#39;include/workflow/WorkFlowHandler.php&#39;,&#39;WorkFlowHandler&#39;, &#39;WorkFlowHandler&#39;);</span>
<span class="x"> $hook_array[&#39;process_record&#39;][] = Array(1, &#39;Other_Shows&#39;, &#39;custom/modules/Performers/performers_logic_hooks.php&#39;,&#39;performers_logic_hooks&#39;, &#39;list_record_process&#39;);</span>

<span class="x">?&gt;</span>
</code></pre></div>

<p>Define the class.</p>
<p>Don't name the class something generic, like logic_hook_class and use
that class name everywhere. It'll cause a bunch of conflicts when it
comes to saving related data, hence the name performers_logic_hooks.</p>
<div class="highlight"><pre><span></span><code><span class="x">class performers_logic_hooks</span>
<span class="x"> {</span>

<span class="x">/**</span>
<span class="x"> * Called as process_record logic hook on the Performers module</span>
<span class="x"> */</span>
<span class="x"> public function list_record_process($bean, $event, $arguments)</span>
<span class="x"> {</span>
<span class="x"> //Do some code to get the related shows for the performer and store in the $other_shows variable</span>

<span class="x">$this-&gt;other_shows_c = $other_shows;</span>
<span class="x"> }</span>

<span class="x">}</span>
</code></pre></div>

<p>Add the field to your listview via studio and do a quick repair/rebuild.
That should hopefully be it.</p>
</article>

        <footer>
            <nav>
                <ul>
                    <li><a href="./pages/contact.html">Contact</a></li>
                    <li>:: <a href="./categories.html">Categories</a></li>
                </ul>
            </nav>
        </footer>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Z9P3V6D0SV"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-Z9P3V6D0SV');
</script>
</body>
</html>