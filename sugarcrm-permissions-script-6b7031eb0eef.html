<!DOCTYPE html>
<html lang="en">
<head>
        <title>Shane Dowling : SugarCRM — Permissions Script</title>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="./theme/css/main.css" type="text/css" />
        <link href="https://shanedowling.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Shane Dowling ATOM Feed" />

        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="./css/ie.css"/>
                <script src="./js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="./css/ie6.css"/><![endif]-->

</head>

<body>
        
<header>
    <h1><a href="." id="site-title">Shane Dowling </a> :
        <a href="./sugarcrm-permissions-script-6b7031eb0eef.html" id="page-title">SugarCRM — Permissions Script</a></h1>
<time datetime="2014-06-21T00:00:00+00:00">Sat 21 June 2014</time></header>
<article>
    <p>I use <a href="http://www.saltstack.com/">salt</a> quite extensively to deploy SugarCRM installs and I wanted a scriptable way to setup the correct permissions for Sugar running on a linux box. This script is based on the <a href="http://support.sugarcrm.com/04_Find_Answers/02KB/02Administration/100Install/Required_File_System_Permissions_on_Linux/">Sugar documentation</a> and this handy post <a href="http://developer.sugarcrm.com/2012/07/19/a-newbies-guide-to-getting-your-sugarcrm-instances-permissions-right/">here</a>.</p>
<p>Simply fill in your apache user details and the path to the Sugar
install and you're away.</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="nv">APACHEUSER</span><span class="o">=</span><span class="s1">&#39;www-data:www-data&#39;</span>
<span class="nv">SUGARPATH</span><span class="o">=</span><span class="s1">&#39;/var/www/sugarcrm&#39;</span>

find<span class="w"> </span>-P<span class="w"> </span><span class="nv">$SUGARPATH</span>/<span class="w"> </span>-type<span class="w"> </span>d<span class="w"> </span>-exec<span class="w"> </span>chmod<span class="w"> </span><span class="m">755</span><span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\\</span><span class="p">;</span>
find<span class="w"> </span>-P<span class="w"> </span><span class="nv">$SUGARPATH</span>/<span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span>-exec<span class="w"> </span>chmod<span class="w"> </span><span class="m">644</span><span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\\</span><span class="p">;</span>
find<span class="w"> </span>-P<span class="w"> </span><span class="nv">$SUGARPATH</span>/<span class="w"> </span>-name<span class="w"> </span>*.js<span class="w"> </span>-exec<span class="w"> </span>chmod<span class="w"> </span><span class="m">755</span><span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\\</span><span class="p">;</span>

chmod<span class="w"> </span><span class="m">664</span><span class="w"> </span><span class="nv">$SUGARPATH</span>/config.php
chmod<span class="w"> </span><span class="m">664</span><span class="w"> </span><span class="nv">$SUGARPATH</span>/config_override.php
chmod<span class="w"> </span><span class="m">664</span><span class="w"> </span><span class="nv">$SUGARPATH</span>/sugarcrm.log

find<span class="w"> </span>-P<span class="w"> </span><span class="nv">$SUGARPATH</span>/cache<span class="w"> </span>-type<span class="w"> </span>d<span class="w"> </span>-exec<span class="w"> </span>chmod<span class="w"> </span><span class="m">775</span><span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\\</span><span class="p">;</span>
find<span class="w"> </span>-P<span class="w"> </span><span class="nv">$SUGARPATH</span>/custom<span class="w"> </span>-type<span class="w"> </span>d<span class="w"> </span>-exec<span class="w"> </span>chmod<span class="w"> </span><span class="m">775</span><span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\\</span><span class="p">;</span>
find<span class="w"> </span>-P<span class="w"> </span><span class="nv">$SUGARPATH</span>/data<span class="w"> </span>-type<span class="w"> </span>d<span class="w"> </span>-exec<span class="w"> </span>chmod<span class="w"> </span><span class="m">775</span><span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\\</span><span class="p">;</span>
find<span class="w"> </span>-P<span class="w"> </span><span class="nv">$SUGARPATH</span>/modules<span class="w"> </span>-type<span class="w"> </span>d<span class="w"> </span>-exec<span class="w"> </span>chmod<span class="w"> </span><span class="m">775</span><span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\\</span><span class="p">;</span>
find<span class="w"> </span>-P<span class="w"> </span><span class="nv">$SUGARPATH</span>/include<span class="w"> </span>-type<span class="w"> </span>d<span class="w"> </span>-exec<span class="w"> </span>chmod<span class="w"> </span><span class="m">775</span><span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\\</span><span class="p">;</span>
find<span class="w"> </span>-P<span class="w"> </span><span class="nv">$SUGARPATH</span>/upload<span class="w"> </span>-type<span class="w"> </span>d<span class="w"> </span>-exec<span class="w"> </span>chmod<span class="w"> </span><span class="m">775</span><span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\\</span><span class="p">;</span>

find<span class="w"> </span>-P<span class="w"> </span><span class="nv">$SUGARPATH</span>/cache<span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span>-exec<span class="w"> </span>chmod<span class="w"> </span><span class="m">664</span><span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\\</span><span class="p">;</span>
find<span class="w"> </span>-P<span class="w"> </span><span class="nv">$SUGARPATH</span>/custom<span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span>-exec<span class="w"> </span>chmod<span class="w"> </span><span class="m">664</span><span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\\</span><span class="p">;</span>
find<span class="w"> </span>-P<span class="w"> </span><span class="nv">$SUGARPATH</span>/data<span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span>-exec<span class="w"> </span>chmod<span class="w"> </span><span class="m">664</span><span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\\</span><span class="p">;</span>
find<span class="w"> </span>-P<span class="w"> </span><span class="nv">$SUGARPATH</span>/modules<span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span>-exec<span class="w"> </span>chmod<span class="w"> </span><span class="m">664</span><span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\\</span><span class="p">;</span>
find<span class="w"> </span>-P<span class="w"> </span><span class="nv">$SUGARPATH</span>/include<span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span>-exec<span class="w"> </span>chmod<span class="w"> </span><span class="m">664</span><span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\\</span><span class="p">;</span>
find<span class="w"> </span>-P<span class="w"> </span><span class="nv">$SUGARPATH</span>/upload<span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span>-exec<span class="w"> </span>chmod<span class="w"> </span><span class="m">664</span><span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\\</span><span class="p">;</span>

chown<span class="w"> </span>-R<span class="w"> </span><span class="nv">$APACHEUSER</span><span class="w"> </span><span class="nv">$SUGARPATH</span>
</code></pre></div>

<p>And the salt config to get this running.</p>
<div class="highlight"><pre><span></span><code><span class="nt">sugar_permissions</span><span class="p">:</span>

<span class="w">  </span><span class="nt">cmd.script</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">salt://deploy/dev/sugar/permissions.sh</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">user</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">shell</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/bin/bash</span>
</code></pre></div>

<p>If you see any issues with the script/salt config please let me know.</p>
<p>Thanks!</p>
</article>

        <footer>
            <nav>
                <ul>
                    <li><a href="./pages/contact.html">Contact</a></li>
                    <li>:: <a href="./categories.html">Categories</a></li>
                </ul>
            </nav>
        </footer>

</body>
</html>