<!DOCTYPE html>
<html lang="en">
<head>
        <title>OfflineImap to Thunderbird</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/pure-min.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-min.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css" />
        <link rel="stylesheet" href="./theme/css/main.css" />
        <link href="https://shanedowling.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Shane Dowling Full Atom Feed" />
        <link href="https://shanedowling.com/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="Shane Dowling Full RSS Feed" />
        <link href="https://shanedowling.com/feeds/category.slug.atom.xml" type="application/atom+xml" rel="alternate" title="Shane Dowling Categories Atom Feed" />
        <link href="https://shanedowling.com/feeds/category.slug.rss.xml" type="application/rss+xml" rel="alternate" title="Shane Dowling Categories RSS Feed" />
</head>
<body>

    <div class="main-nav-container">

        <div class="pure-g">
            <div class="pure-u-1 pure-u-lg-2-3">
                <div class="main-nav">
                    <ul class="main-nav-list">
                        <li class="main-nav-item"><a href="./" class="pure-menu-link">Shane Dowling</a></li>

                        <li class="main-nav-item"><a href="./category/til.html" class="pure-menu-link">TIL</a></li>
                        <li class="main-nav-item"><a href="./category/tech.html" class="pure-menu-link">Tech</a></li>
                        <li class="main-nav-item"><a href="./category/random.html" class="pure-menu-link">Random</a></li>
                        <li class="main-nav-item"><a href="./category/productivity.html" class="pure-menu-link">Productivity</a></li>
                        <li class="main-nav-item active"><a href="./category/posts.html" class="pure-menu-link">posts</a></li>
                        <li class="main-nav-item"><a href="./category/digital-minimalism.html" class="pure-menu-link">Digital Minimalism</a></li>
                    </ul>
                </div>
             </div>

             <div class="pure-u-1 pure-u-lg-1-3"></div>
        </div>

    </div>


<div class="page-container">
    <div class="entry-content">
        <div class="post-meta pure-g">
            <div class="pure-u-3-4 meta-data">
                <a href="./category/posts.html" class="category">posts</a><br />

                <a class="author" href="./author/shane-dowling.html">Shane Dowling</a>
                &mdash; <abbr title="2014-02-08T00:00:00+00:00">Sat 08 February 2014</abbr>
            </div>
        </div>
    </div>

    <div class="article-header-container">
        <div class="background-image-container">

            <div class="background-image-small">
                <div class="title-container">
                    <h1>OfflineImap to Thunderbird</h1>
                </div>
            </div>
        </div>
    </div>

    <div class="entry-content">
        <p>Last week I moved from Debian to Linux Mint and setup Thunderbird as my
new mail client(replacing mutt). Sadly for some reason Thunderbird
started tanking and wiped all the mails from my mailserver without
actually downloading anything.</p>
<p>I could’ve restored the mails from a backup but instead I figured I’d
take my emails offline and use Thunderbird as my primary mail client. I
had a backup of my mails from OfflineImap but the problem was that
OfflineImap uses the MailDir format and Thunderbird didn’t support it.</p>
<p>Luckily Thunderbird did support maildir and I modified an existing
MailDir to Mbox converter written in Python to work with Offlineimaps
potentially infinitely recursive folder format. Hopefully it helps
someone else.</p>
<h1>!/usr/bin/env python</h1>
<p>“””
 Shane Dowling, 8 Feb 2013
 Frédéric Grosshans, 19 January 2012
 Nathan R. Yergler, 6 June 2010</p>
<p>This file does not contain sufficient creative expression to invoke
 assertion of copyright. No warranty is expressed or implied; use at
 your own risk.</p>
<p>— -</p>
<p>Uses Python’s included mailbox library to convert mail archives from
 maildir [http://en.wikipedia.org/wiki/Maildir] to
 mbox [http://en.wikipedia.org/wiki/Mbox] format, icluding subfolder.</p>
<p>See <a href="http://docs.python.org/library/mailbox.html#mailbox.Mailbox">http://docs.python.org/library/mailbox.html#mailbox.Mailbox</a> for
 full documentation on this library.</p>
<p>— -</p>
<p>$ python md2mb.py [maildir_path] [mbox_filename]</p>
<p>[maildir_path] should be the the path to the actual maildir (containing new,
 cur, tmp, and the subfolders, which are hidden directories with names like
 .subfolde.subsubfolder.subsubsbfolder);</p>
<p>[mbox_filename] will be newly created, as well as a [mbox_filename].sbd the
 directory.
 “””</p>
<p>import mailbox
 import sys
 import email
 import os</p>
<p>def maildir2mailbox(maildirname, mboxfilename):
 “””
 slightly adapted from maildir2mbox.py,
 Nathan R. Yergler, 6 June 2010
 <a href="http://yergler.net/blog/2010/06/06/batteries-included-or-maildir-to-mbox-again/">http://yergler.net/blog/2010/06/06/batteries-included-or-maildir-to-mbox-again/</a>
 and Frédéric Grosshans, 19 January 2012
 <a href="http://stackoverflow.com/questions/2501182/convert-maildir-to-mbox">http://stackoverflow.com/questions/2501182/convert-maildir-to-mbox</a></p>
<p>“””
 # open the existing maildir and the target mbox file
 maildir = mailbox.Maildir(maildirname, email.message_from_file)
 mbox = mailbox.mbox(mboxfilename)</p>
<p># lock the mbox
 mbox.lock()</p>
<p># iterate over messages in the maildir and add to the mbox
 mbox.add(msg)</p>
<p># close and unlock
 mbox.close()
 maildir.close()</p>
<h1>Creates the main mailbox</h1>
<p>dirname=sys.argv[-2]
 mboxname=sys.argv[-1]
 mboxdirname=mboxname+’.sbd’
 if not os.path.exists(mboxdirname): os.makedirs(mboxdirname)</p>
<p># Iterate over all folders
 def folder_iterate(dirname, mboxname):
 listofdirs=[dn for dn in os.walk(dirname).next()[1] if dn not in [‘new’, ‘cur’, ‘tmp’]]
 curlist=[mboxname]+curfold.split(‘.’)
 curpath=os.path.join(*[dn+’.sbd’ for dn in curlist if dn])
 if not os.path.exists(curpath): os.makedirs(curpath)
 maildir2mailbox(os.path.join(dirname,curfold),curpath[:-4])
 print(‘no maildir folders’)
 folder_iterate(os.path.join(dirname,curfold), mboxname)</p>
<p>folder_iterate(dirname, mboxname)
 print(‘Done’)</p>
    </div>

    <footer>
        <div class="pure-g post-footer">
            <div class="pure-u-1 pure-u-md-1-2">
                <div class="pure-g poster-info">
                    <div class="pure-u-3-4">
                        <h3 class="author-name"><a href="./author/shane-dowling.html">Shane Dowling</a></h3>
                        <p class="author-description">
                        </p>
                    </div>
                </div>
            </div>



        </div>


    </footer>


</div>


</body>
</html>