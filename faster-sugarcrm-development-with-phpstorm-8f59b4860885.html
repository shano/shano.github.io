<!DOCTYPE html>
<html lang="en">
<head>
        <title>Shane Dowling : Faster SugarCRM Development with PHPStorm</title>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="./theme/css/main.css" type="text/css" />
        <link href="https://shanedowling.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Shane Dowling ATOM Feed" />

        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="./css/ie.css"/>
                <script src="./js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="./css/ie6.css"/><![endif]-->

</head>

<body>
        
<header>
    <h1><a href="." id="site-title">Shane Dowling </a> :
        <a href="./faster-sugarcrm-development-with-phpstorm-8f59b4860885.html" id="page-title">Faster SugarCRM Development with PHPStorm</a></h1>
<time datetime="2017-04-30T00:00:00+00:00">Sun 30 April 2017</time></header>
<article>
    <p><img alt="" src="images/1__QzgJ__r__gWS5Nddl0PmJlSw.png"></p>
<p>Javascript development with SugarCRM can be a bit of a pain, however combining PHPStorm's filewatcher tool with a cut down repair script can speed things up to a more tolerable level.</p>
<p>What this setup does is watch for any javascript changes in our custom/ folder(because you're not making core hacks are you?) and execute a light-weight repair script when any of those files change. So you'll hit save in PHPStorm, wait a few seconds and your dev javascript should be refreshed and ready to test.</p>
<p>The Repair Script
-—-—-—-— -</p>
<p>First thing to do is get our hands on a fast repair script. Thankfully FrancescaS on the SugarCRM forums came up with a tidy javascript focused version of a repair script(originally by Jeff Bikart. The whole thread is `here `__ but I'll reproduce the code below for the lazy.</p>
<div class="highlight"><pre><span></span><code><span class="x">/*</span>
<span class="x">* Copyright 2013</span>
<span class="x">* Jeff Bickart</span>
<span class="x">* @bickart</span>
<span class="x">* jeff @ neposystems.com</span>
<span class="x">* modified by FrancescaS @ wolfram.com to repair/rebuild</span>
<span class="x">* only what absolutely necessary to work on js scripts</span>
<span class="x">*/</span>
<span class="x">if(!defined(&#39;sugarEntry&#39;))define(&#39;sugarEntry&#39;, true);</span>
<span class="x">require_once(&#39;include/entryPoint.php&#39;);</span>
<span class="x">require_once(&#39;modules/Administration/QuickRepairAndRebuild.php&#39;);</span>
<span class="x">//Bug 27991 . Redirect to index.php if the request is not come from CLI.</span>
<span class="x">$sapi_type = php_sapi_name();</span>
<span class="x">if (substr($sapi_type, 0, 3) != &#39;cgi&#39;) {</span>
<span class="x">global $sugar_config;</span>
<span class="x">if(!empty($sugar_config[&#39;site_url&#39;])){</span>
<span class="x">}else{</span>
<span class="x">sugar_die(&quot;Didn&#39;t find site url in your sugarcrm config file&quot;);</span>
<span class="x">}</span>
<span class="x">}</span>
<span class="x">//End of #27991</span>
<span class="x">if(empty($current_language)) {</span>
<span class="x">$current_language = $sugar_config[&#39;default_language&#39;];</span>
<span class="x">}</span>
<span class="x">$app_list_strings = return_app_list_strings_language($current_language);</span>
<span class="x">$app_strings = return_application_language($current_language);</span>
<span class="x">global $current_user;</span>
<span class="x">$current_user = new User();</span>
<span class="x">$current_user-&gt;getSystemUser();</span>
<span class="x">$GLOBALS[&#39;log&#39;]-&gt;debug(&#39;-—-—-—-—-—-—-—-—-—-—-→ at repair.php ←-—-—-—-—-—-—-—-—-—-—-&#39;);</span>
<span class="x">$repair = new RepairAndClear();</span>
<span class="x">// replace the repairAndClearAll with a limited set or clear actions</span>
<span class="x">//$repair-&gt;repairAndClearAll(array(&#39;clearAll&#39;),array(translate(&#39;LBL_ALL_MODULES&#39;)), true,false,&#39;&#39;);</span>
<span class="x">$repair-&gt;module_list= array(translate(&#39;LBL_ALL_MODULES&#39;));</span>
<span class="x">$repair-&gt;show_output = false;</span>
<span class="x">$repair-&gt;execute= true;</span>
<span class="x">$repair-&gt;clearLanguageCache();</span>
<span class="x">MetaDataManager::enableCacheRefreshQueue();</span>
<span class="x">$repair-&gt;clearTpls();</span>
<span class="x">$repair-&gt;clearJsFiles();</span>
<span class="x">$repair-&gt;clearJsLangFiles();</span>
<span class="x">$repair-&gt;clearLanguageCache();</span>
<span class="x">$repair-&gt;clearDashlets();</span>
<span class="x">$repair-&gt;clearSmarty();</span>
<span class="x">$repair-&gt;clearThemeCache();</span>
<span class="x">$repair-&gt;clearXMLfiles();</span>
<span class="x">$repair-&gt;clearExternalAPICache();</span>
<span class="x">$repair-&gt;clearAdditionalCaches();</span>
<span class="x">$repair-&gt;clearPDFFontCache();</span>
<span class="x">$repair-&gt;repairMetadataAPICache();</span>
<span class="x">$exit_on_cleanup = true;</span>
<span class="x">sugar_cleanup(false);</span>
<span class="x">// some jobs have annoying habit of calling sugar_cleanup(), and it can be called only once</span>
<span class="x">// but job results can be written to DB after job is finished, so we have to disconnect here again</span>
<span class="x">// just in case we couldn&#39;t call cleanup</span>
<span class="x">if(class_exists(&#39;DBManagerFactory&#39;)) {</span>
<span class="x">$db = DBManagerFactory::getInstance();</span>
<span class="x">$db-&gt;disconnect();</span>
<span class="x">}</span>
<span class="x">if($exit_on_cleanup) exit;</span>
</code></pre></div>

<p>Take this file and move it to your ~/Bin folder or wherever you tend to put these one off little scripts.</p>
<p>The Watcher</p>
<p>The next thing to do is configure PHPStorm to start watching for Javascript file changes.</p>
<p>Go into Settings-&gt;Tools-&gt;File Watchers and hit the green plus to add a new watcher.</p>
<p><img alt="" src="images/1____XfSAae6p__j0R8XD__MGAHg.png">
<img alt="" src="images/1__jOrBq5xCqCJ7ONApQjVfww.png"></p>
<p>Simply alter your pattern to whatever your SugarCRM project structure looks like.</p>
<p>You should see a count of the number of files the scope has detected in the project and it should be more than 0, so use that as a guide to ensure the scope is correctly identifying all your interesting javascript files.</p>
<p>Once the scope is sorted, back in the watcher configuration, for the 'Argument' setting you will need to put in the path to the repair script from above then finally, for the 'Working Directory' put the root of the SugarCRM source.</p>
<p>After all of that is configured make some changes to a javascript file, hit save and hopefully you should see the 'Watch for JS Changes' task running for a few seconds.</p>
</article>

        <footer>
            <nav>
                <ul>
                    <li><a href="./pages/contact.html">Contact</a></li>
                    <li>:: <a href="./categories.html">Categories</a></li>
                </ul>
            </nav>
                <p id="theme-credit"><a href="http://mathieu.agopian.info/mnmlist/theme.html">Thème mnmlist</a></p>
        </footer>

</body>
</html>