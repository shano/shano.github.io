<!DOCTYPE html>
<html lang="en">
<head>
        <title>Build Yii 1.* with composer</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/pure-min.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-min.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css" />
        <link rel="stylesheet" href="./theme/css/main.css" />
        <link rel="stylesheet" href="./theme/css/forms.css" />
        <link rel="stylesheet" href="./theme/fonts/fonts.css" />
        <link href="https://shanedowling.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Shane Dowling Full Atom Feed" />
        <link href="https://shanedowling.com/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="Shane Dowling Full RSS Feed" />
        <link href="https://shanedowling.com/feeds/category.slug.atom.xml" type="application/atom+xml" rel="alternate" title="Shane Dowling Categories Atom Feed" />
        <link href="https://shanedowling.com/feeds/category.slug.rss.xml" type="application/rss+xml" rel="alternate" title="Shane Dowling Categories RSS Feed" />
</head>
<body>

    <div class="main-nav-container">

        <div class="pure-g">
            <div class="pure-u-1 pure-u-lg-2-3">
                <div class="main-nav">
                    <ul class="main-nav-list">
                        <li class="main-nav-item"><a href="./" class="pure-menu-link">Shane Dowling</a></li>

                        <li class="main-nav-item"><a href="./category/til.html" class="pure-menu-link">TIL</a></li>
                        <li class="main-nav-item active"><a href="./category/tech.html" class="pure-menu-link">Tech</a></li>
                        <li class="main-nav-item"><a href="./category/random.html" class="pure-menu-link">Random</a></li>
                        <li class="main-nav-item"><a href="./category/productivity.html" class="pure-menu-link">Productivity</a></li>
                        <li class="main-nav-item"><a href="./category/mindfulness.html" class="pure-menu-link">Mindfulness</a></li>
                        <li class="main-nav-item"><a href="./category/leadership.html" class="pure-menu-link">Leadership</a></li>
                        <li class="main-nav-item"><a href="./category/digital-minimalism.html" class="pure-menu-link">Digital Minimalism</a></li>
                        <li class="main-nav-item"><a href="./pages/contact.html" class="pure-menu-link">Contact</a></li>
                    </ul>
                </div>
             </div>

             <div class="pure-u-1 pure-u-lg-1-3"></div>
        </div>

    </div>


<div class="page-container">
    <div class="entry-content">
        <div class="post-meta pure-g">
            <div class="pure-u-3-4 meta-data">
                <a href="./category/tech.html" class="category">Tech</a><br />

                <a class="author" href="./author/shane-dowling.html">Shane Dowling</a>
                &mdash; <abbr title="2014-04-08T00:00:00+00:00">Tue 08 April 2014</abbr>
            </div>
        </div>
    </div>

    <div class="article-header-container">
        <div class="background-image-container">

            <div class="background-image-small">
                <div class="title-container">
                    <h1>Build Yii 1.* with composer</h1>
                </div>
            </div>
        </div>
    </div>

    <div class="entry-content">
        <p><img alt="" src="images/1__l9C5aZ3qEUjpuOr__ZRZtbw.png"></p>
<p>While we're looking forward to Yii 2 coming alive, all of the posts on
please do not use it for production**. So it might be a little while
before we have in-built composer awesomeness with Yii. <a href="http://www.yiiframework.com/wiki/392/creating-yii-applications-with-composer/">The guide
online</a> on integrating composer with yii does not seem particularly
straight-forward and misses out on a lot of steps, hence this post. You
basically need to have the right folder structure or things will start
to break. This guide relies on some of phundaments packages to get
things up and running, as the official yii composer project doesn't work
anymore.</p>
<ul>
<li>Create the root folder my_yii_install.</li>
<li>mkdir -p my_yii_install/protected/config</li>
<li>In my_yii_install/protected/ <a href="https://getcomposer.org/download/">download the composer.phar</a> and create a composer.json like so.</li>
</ul>
<div class="highlight"><pre><span></span><span class="p">{</span>
 <span class="nt">&quot;repositories&quot;</span><span class="p">:</span> <span class="p">[</span>
 <span class="p">{</span>
 <span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;composer&quot;</span><span class="p">,</span>
 <span class="nt">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;http://packages.phundament.com&quot;</span>
 <span class="p">}</span>
 <span class="p">],</span>
 <span class="nt">&quot;require&quot;</span><span class="p">:</span> <span class="p">{</span>
 <span class="nt">&quot;php&quot;</span><span class="p">:</span> <span class="s2">&quot;&gt;=5.3.2&quot;</span><span class="p">,</span>
 <span class="nt">&quot;yiisoft/yii&quot;</span><span class="p">:</span> <span class="s2">&quot;1.1.*&quot;</span><span class="p">,</span>
 <span class="nt">&quot;yiiext/migrate-command&quot;</span><span class="p">:</span> <span class="s2">&quot;0.7.*&quot;</span>
 <span class="p">},</span>
 <span class="nt">&quot;config&quot;</span><span class="p">:</span> <span class="p">{</span>
 <span class="nt">&quot;bin-dir&quot;</span><span class="p">:</span> <span class="s2">&quot;bin/&quot;</span>
 <span class="p">},</span>
 <span class="nt">&quot;autoload&quot;</span><span class="p">:</span> <span class="p">{</span>
 <span class="nt">&quot;psr-0&quot;</span><span class="p">:</span> <span class="p">{</span>
 <span class="nt">&quot;config&quot;</span><span class="p">:</span> <span class="s2">&quot;./&quot;</span>
 <span class="p">}</span>
 <span class="p">},</span>
 <span class="nt">&quot;scripts&quot;</span><span class="p">:</span> <span class="p">{</span>
 <span class="nt">&quot;pre-install-cmd&quot;</span><span class="p">:</span> <span class="s2">&quot;config\\\\ComposerCallback::preInstall&quot;</span><span class="p">,</span>
 <span class="nt">&quot;post-install-cmd&quot;</span><span class="p">:</span> <span class="s2">&quot;config\\\\ComposerCallback::postInstall&quot;</span><span class="p">,</span>
 <span class="nt">&quot;pre-update-cmd&quot;</span><span class="p">:</span> <span class="s2">&quot;config\\\\ComposerCallback::preUpdate&quot;</span><span class="p">,</span>
 <span class="nt">&quot;post-update-cmd&quot;</span><span class="p">:</span> <span class="s2">&quot;config\\\\ComposerCallback::postUpdate&quot;</span><span class="p">,</span>
 <span class="nt">&quot;post-package-install&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;config\\\\ComposerCallback::postPackageInstall&quot;</span><span class="p">],</span>
 <span class="nt">&quot;post-package-update&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;config\\\\ComposerCallback::postPackageUpdate&quot;</span><span class="p">]</span>
 <span class="p">}</span>
 <span class="p">}</span>
</pre></div>


<ul>
<li>In my_yii_install/config add console.php</li>
</ul>
<div class="highlight"><pre><span></span><span class="x">return array(</span>
<span class="x"> &#39;aliases&#39; =&gt; array(</span>
<span class="x"> &#39;vendor&#39; =&gt; &#39;application.vendor&#39;,</span>
<span class="x"> ),</span>
<span class="x"> &#39;basePath&#39; =&gt; dirname(__FILE__) . DIRECTORY_SEPARATOR .&#39;..&#39;,</span>
<span class="x"> &#39;name&#39; =&gt; &#39;My Awesome Yii Site&#39;,</span>
<span class="x"> &#39;components&#39; =&gt; array(</span>
<span class="x"> &#39;db&#39; =&gt; array(</span>
<span class="x"> // MySQL</span>
<span class="x"> &#39;connectionString&#39; =&gt; &#39;mysql:host=localhost;dbname=my_yii_database&#39;,</span>
<span class="x"> &#39;emulatePrepare&#39; =&gt; true,</span>
<span class="x"> &#39;username&#39; =&gt; &#39;root&#39;,</span>
<span class="x"> &#39;password&#39; =&gt; &#39;root&#39;,</span>
<span class="x"> &#39;charset&#39; =&gt; &#39;utf8&#39;,</span>
<span class="x"> ),</span>
<span class="x"> ),</span>
<span class="x"> &#39;params&#39; =&gt; array(</span>
<span class="x"> &#39;composer.callbacks&#39; =&gt; array(</span>
<span class="x"> // args for Yii command runner</span>
<span class="x"> &#39;yiisoft/yii-install&#39; =&gt; array(&#39;yiic&#39;, &#39;webapp&#39;, dirname(__FILE__).DIRECTORY_SEPARATOR.&#39;..&#39;.DIRECTORY_SEPARATOR.&#39;..&#39;),</span>
<span class="x"> &#39;post-update&#39; =&gt; array(&#39;yiic&#39;, &#39;migrate&#39;),</span>
<span class="x"> &#39;post-install&#39; =&gt; array(&#39;yiic&#39;, &#39;migrate&#39;),</span>
<span class="x"> ),</span>
<span class="x"> ),</span>
<span class="x"> );</span>
</pre></div>


<ul>
<li>Now you'll need to add a file like the below to actually handle the new composer hooks you've created. This will basically run migrations once your dependencies have installed.</li>
</ul>
<p>This is blantantly taken from phundaments <a href="https://github.com/phundament/app/blob/yii-webapp/protected/config/ComposerCallback.php">ComposerCallback</a>.
I just thought I'd copy it here for completeness.</p>
<p>ComposerCallback.php</p>
<div class="highlight"><pre><span></span><span class="x">/**</span>
<span class="x"> * Class file</span>
<span class="x"> *“</span>
<span class="x"> * @author Tobias Munk</span>
<span class="x"> * @link [http://www.phundament.com/](http://www.phundament.com/)</span>
<span class="x"> * @copyright Copyright © 2012 diemeisterei GmbH</span>
<span class="x"> * @license [http://www.phundament.com/license](http://www.phundament.com/license)</span>
<span class="x"> */</span>

<span class="x">namespace config;</span>
<span class="x"> use Composer\\Script\\Event;</span>

<span class="x">/**</span>
<span class="x"> * ComposerCallback provides composer hooks</span>
<span class="x"> *</span>
<span class="x"> * This setup class triggers \`./yiic migrate\` at post-install and post-update.</span>
<span class="x"> * For a package the class triggers \`./yiic -\` at post-package-install and</span>
<span class="x"> * post-package-update.</span>
<span class="x"> * See composer manual (http://getcomposer.org/doc/articles/scripts.md)</span>
<span class="x"> *</span>
<span class="x"> * Usage example</span>
<span class="x"> *</span>
<span class="x"> * config.php</span>
<span class="x"> * &#39;params&#39; =&gt; array(</span>
<span class="x"> * &#39;composer.callbacks&#39; =&gt; array(</span>
<span class="x"> * &#39;post-update&#39; =&gt; array(&#39;yiic&#39;, &#39;migrate&#39;),</span>
<span class="x"> * &#39;post-install&#39; =&gt; array(&#39;yiic&#39;, &#39;migrate&#39;),</span>
<span class="x"> * &#39;yiisoft/yii-install&#39; =&gt; array(&#39;yiic&#39;, &#39;webapp&#39;, realpath(dirname(__FILE__))),</span>
<span class="x"> * ),</span>
<span class="x"> * )</span>
<span class="x"> * );</span>
</pre></div>


<ul>
<li>composer.json</li>
</ul>
<div class="highlight"><pre><span></span> <span class="nt">&quot;scripts&quot;</span><span class="p">:</span> <span class="p">{</span>
 <span class="nt">&quot;pre-install-cmd&quot;</span><span class="p">:</span> <span class="s2">&quot;config\\\\ComposerCallback::preInstall&quot;</span><span class="p">,</span>
 <span class="nt">&quot;post-install-cmd&quot;</span><span class="p">:</span> <span class="s2">&quot;config\\\\ComposerCallback::postInstall&quot;</span><span class="p">,</span>
 <span class="nt">&quot;pre-update-cmd&quot;</span><span class="p">:</span> <span class="s2">&quot;config\\\\ComposerCallback::preUpdate&quot;</span><span class="p">,</span>
 <span class="nt">&quot;post-update-cmd&quot;</span><span class="p">:</span> <span class="s2">&quot;config\\\\ComposerCallback::postUpdate&quot;</span><span class="p">,</span>
 <span class="nt">&quot;post-package-install&quot;</span><span class="p">:</span> <span class="p">[</span>
 <span class="s2">&quot;config\\\\ComposerCallback::postPackageInstall&quot;</span>
 <span class="p">],</span>
 <span class="nt">&quot;post-package-update&quot;</span><span class="p">:</span> <span class="p">[</span>
 <span class="s2">&quot;config\\\\ComposerCallback::postPackageUpdate&quot;</span>
 <span class="p">]</span>
 <span class="p">}</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="x">*</span>
<span class="x"> *</span>
<span class="x"> * @author Tobias Munk</span>
<span class="x"> * @package phundament.app</span>
<span class="x"> * @since 0.7.1</span>
<span class="x"> */</span>

<span class="x">defined(&#39;YII_PATH&#39;) or define(&#39;YII_PATH&#39;, dirname(__FILE__).&#39;/../vendor/yiisoft/yii/framework&#39;);</span>
<span class="x"> defined(&#39;CONSOLE_CONFIG&#39;) or define(&#39;CONSOLE_CONFIG&#39;, dirname(__FILE__).&#39;/console.php&#39;);</span>

<span class="x">class ComposerCallback</span>
<span class="x"> {</span>
<span class="x"> /**</span>
<span class="x"> * Displays welcome message</span>
<span class="x"> * @static</span>
<span class="x"> * @param ComposerScriptEvent $event</span>
<span class="x"> */</span>
<span class="x"> public static function preInstall(Event $event)</span>
<span class="x"> {</span>
<span class="x"> $composer = $event-&gt;getComposer();</span>
<span class="x"> // do stuff</span>
<span class="x"> echo &quot;Phundament 3 Installernn&quot;;</span>
<span class="x"> echo &quot; * download packages specified in composer.json</span>
<span class="x"> * trigger composer callbacksnn&quot;;</span>
<span class="x"> if (self::confirm(&quot;Start Installation?&quot;)) {</span>
<span class="x"> self::runHook(&#39;pre-install&#39;);</span>
<span class="x"> } else {</span>
<span class="x"> exit(&quot;Installation aborted.n&quot;);</span>
<span class="x"> }</span>
<span class="x"> }</span>

<span class="x">/**</span>
<span class="x"> * Executes ./yiic migrate</span>
<span class="x"> * @static</span>
<span class="x"> * @param ComposerScriptEvent $event</span>
<span class="x"> */</span>
<span class="x"> public static function postInstall(Event $event)</span>
<span class="x"> {</span>
<span class="x"> self::runHook(&#39;post-install&#39;);</span>
<span class="x"> echo &quot;nnInstallation completed.nnThank you for choosing Phundament 3!nn&quot;;</span>
<span class="x"> }</span>

<span class="x">/**</span>
<span class="x"> * Displays welcome message</span>
<span class="x"> *</span>
<span class="x"> * @static</span>
<span class="x"> * @param ComposerScriptEvent $event</span>
<span class="x"> */</span>
<span class="x"> public static function preUpdate(Event $event)</span>
<span class="x"> {</span>
<span class="x"> echo &quot;Welcome to Phundament Installation 3 via composernnUpdating your application to the lastest available packages…n&quot;;</span>
<span class="x"> self::runHook(&#39;pre-update&#39;);</span>
<span class="x"> }</span>

<span class="x">/**</span>
<span class="x"> * Executes ./yiic migrate</span>
<span class="x"> *</span>
<span class="x"> * @static</span>
<span class="x"> * @param ComposerScriptEvent $event</span>
<span class="x"> */</span>
<span class="x"> public static function postUpdate(Event $event)</span>
<span class="x"> {</span>
<span class="x"> self::runHook(&#39;post-update&#39;);</span>
<span class="x"> echo &quot;nnUpdate completed.nn&quot;;</span>
<span class="x"> }</span>

<span class="x">/**</span>
<span class="x"> * Executes ./yiic -</span>
<span class="x"> *</span>
<span class="x"> * @static</span>
<span class="x"> * @param ComposerScriptEvent $event</span>
<span class="x"> */</span>
<span class="x"> public static function postPackageInstall(Event $event)</span>
<span class="x"> {</span>
<span class="x"> $installedPackage = $event-&gt;getOperation()-&gt;getPackage();</span>
<span class="x"> $hookName = $installedPackage-&gt;getPrettyName().&#39;-install&#39;;</span>
<span class="x"> self::runHook($hookName);</span>
<span class="x"> }</span>

<span class="x">/**</span>
<span class="x"> * Executes ./yiic -</span>
<span class="x"> *</span>
<span class="x"> * @static</span>
<span class="x"> * @param ComposerScriptEvent $event</span>
<span class="x"> */</span>
<span class="x"> public static function postPackageUpdate(Event $event)</span>
<span class="x"> {</span>
<span class="x"> $installedPackage = $event-&gt;getOperation()-&gt;getTargetPackage();</span>
<span class="x"> $commandName = $installedPackage-&gt;getPrettyName().&#39;-update&#39;;</span>
<span class="x"> self::runHook($commandName);</span>
<span class="x"> }</span>

<span class="x">/**</span>
<span class="x"> * Asks user to confirm by typing y or n.</span>
<span class="x"> *</span>
<span class="x"> * Credits to Yii CConsoleCommand</span>
<span class="x"> *</span>
<span class="x"> * @param string $message to echo out before waiting for user input</span>
<span class="x"> * @return bool if user confirmed</span>
<span class="x"> */</span>
<span class="x"> public static function confirm($message)</span>
<span class="x"> {</span>
<span class="x"> echo $message . &#39; [yes|no] &#39;;</span>
<span class="x"> return !strncasecmp(trim(fgets(STDIN)), &#39;y&#39;, 1);</span>
<span class="x"> }</span>

<span class="x">/**</span>
<span class="x"> * Runs Yii command, if available (defined in config/console.php)</span>
<span class="x"> */</span>
<span class="x"> private static function runHook($name){</span>
<span class="x"> $app = self::getYiiApplication();</span>
<span class="x"> if ($app === null) return;</span>

<span class="x">if (isset($app-&gt;params[&#39;composer.callbacks&#39;][$name])) {</span>
<span class="x"> $args = $app-&gt;params[&#39;composer.callbacks&#39;][$name];</span>
<span class="x"> $app-&gt;commandRunner-&gt;addCommands(Yii::getPathOfAlias(&#39;system.cli.commands&#39;));</span>
<span class="x"> $app-&gt;commandRunner-&gt;run($args);</span>
<span class="x"> }</span>
<span class="x"> }</span>

<span class="x">/**</span>
<span class="x"> * Creates console application, if Yii is available</span>
<span class="x"> */</span>
<span class="x"> private static function getYiiApplication()</span>
<span class="x"> {</span>
<span class="x"> if (!is_file(YII_PATH.&#39;/yii.php&#39;))</span>
<span class="x"> {</span>
<span class="x"> return null;</span>
<span class="x"> }</span>

<span class="x">require_once(YII_PATH.&#39;/yii.php&#39;);</span>
<span class="x"> spl_autoload_register(array(&#39;YiiBase&#39;, &#39;autoload&#39;));</span>

<span class="x">if (Yii::app() === null) {</span>
<span class="x"> if (is_file(CONSOLE_CONFIG)) {</span>
<span class="x"> $app = Yii::createConsoleApplication(CONSOLE_CONFIG);</span>
<span class="x"> } else {</span>
<span class="x"> throw new Exception(&quot;File from CONSOLE_CONFIG not found&quot;);</span>
<span class="x"> }</span>
<span class="x"> } else {</span>
<span class="x"> $app = Yii::app();</span>
<span class="x"> }</span>
<span class="x"> return $app;</span>
<span class="x"> }</span>

<span class="x">}</span>
</pre></div>


<ul>
<li>Now you should be able to run</li>
</ul>
<div class="highlight"><pre><span></span>php composer.phar install
</pre></div>


<p>and it should ask do you want to setup your yii project and all of the
required folders, which is pretty awesome. The only other thing you
might want to do is add more dependencies. Say you have a library you
wish to add. Add the entry into composer.json run the update(which
should call any migrations needed automatically), then you need to add
this line to your index.php.</p>
<div class="highlight"><pre><span></span><span class="x">require_once(dirname(__FILE__).&#39;/protected/vendor/autoload.php&#39;);</span>
</pre></div>


<p>And should be be good to access composers namespaces libraries. Very
cool!</p>
    </div>

    <footer>
        <div class="pure-g post-footer">
            <div class="pure-u-1 pure-u-md-1-2">
                <div class="pure-g poster-info">
                    <div class="pure-u-3-4">
                        <h3 class="author-name"><a href="./author/shane-dowling.html">Shane Dowling</a></h3>
                        <p class="author-description">
                        </p>
                    </div>
                </div>
            </div>



        </div>


    </footer>


</div>


    <!-- Matomo -->
        <script>
          var _paq = window._paq = window._paq || [];
          /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
          _paq.push(['trackPageView']);
          _paq.push(['enableLinkTracking']);
          (function() {
            var u="//stats.shanedowling.com/";
            _paq.push(['setTrackerUrl', u+'matomo.php']);
                  _paq.push(['setSiteId', '1']);
            var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
            g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
          })();
        </script>
        <!-- End Matomo Code -->
</body>
</html>