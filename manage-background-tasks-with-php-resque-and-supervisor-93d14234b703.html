<!DOCTYPE html>
<html lang="en">
<head>
        <title>Manage background tasks with PHP-Resque and Supervisor</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/pure-min.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-min.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css" />
        <link rel="stylesheet" href="./theme/css/main.css" />
        <link href="https://shanedowling.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Shane Dowling Full Atom Feed" />
        <link href="https://shanedowling.com/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="Shane Dowling Full RSS Feed" />
        <link href="https://shanedowling.com/feeds/category.slug.atom.xml" type="application/atom+xml" rel="alternate" title="Shane Dowling Categories Atom Feed" />
        <link href="https://shanedowling.com/feeds/category.slug.rss.xml" type="application/rss+xml" rel="alternate" title="Shane Dowling Categories RSS Feed" />
</head>
<body>

    <div class="main-nav-container">

        <div class="pure-g">
            <div class="pure-u-1 pure-u-lg-2-3">
                <div class="main-nav">
                    <ul class="main-nav-list">
                        <li class="main-nav-item"><a href="./" class="pure-menu-link">Shane Dowling</a></li>

                        <li class="main-nav-item"><a href="./category/til.html" class="pure-menu-link">TIL</a></li>
                        <li class="main-nav-item active"><a href="./category/posts.html" class="pure-menu-link">posts</a></li>
                        <li class="main-nav-item"><a href="./category/digital-minimalism.html" class="pure-menu-link">Digital Minimalism</a></li>
                    </ul>
                </div>
             </div>

             <div class="pure-u-1 pure-u-lg-1-3"></div>
        </div>

    </div>


<div class="page-container">
    <div class="entry-content">
        <div class="post-meta pure-g">
            <div class="pure-u-3-4 meta-data">
                <a href="./category/posts.html" class="category">posts</a><br />

                <a class="author" href="./author/shane-dowling.html">Shane Dowling</a>
                &mdash; <abbr title="2014-07-03T00:00:00+00:00">Thu 03 July 2014</abbr>
            </div>
        </div>
    </div>

    <div class="article-header-container">
        <div class="background-image-container">

            <div class="background-image-small">
                <div class="title-container">
                    <h1>Manage background tasks with PHP-Resque and Supervisor</h1>
                </div>
            </div>
        </div>
    </div>

    <div class="entry-content">
        <p><img alt="" src="images/1__DDS7CsAlPK7wTEEbPFLRAQ.jpeg"></p>
<p><a href="https://github.com/chrisboulton/php-resque">PHP-Resque</a>, the PHP equivalent to Ruby’s really nice background process runner is a great way to execute long running PHP processes. <a href="http://supervisord.org/">Supervisor</a> is a python-based process control system, essentially it’s a convenient way to manage custom system processes you need to handle. Combining the two to manage long running PHP jobs makes a lot of sense but it takes a little bit of work to get them talking.</p>
<p>Once you’ve gotten PHP-Resque <a href="https://github.com/chrisboulton/php-resque#getting-started">installed on your project</a>,
you’ve <a href="https://github.com/chrisboulton/php-resque#queueing-jobs">added items to your queue</a> and <a href="https://github.com/chrisboulton/php-resque#defining-jobs">written the workers to handle the background tasks</a>.
You’ll need to plug PHP-Resque into supervisor. Here’s a sample config
file I used to manage php resque queues within Yii projects but it
should work with anything that’s using php-resque.</p>
<p>[program:my_resque]
 directory=/var/www/website
 command=php vendor/chrisboulton/php-resque/bin/resque
 numprocs=2
 environment=QUEUE=’myresquequeue’,BLOCKING=1,COUNT=1,APP_INCLUDE=’models/UsefulClasses.php’
 autostart=true
 autorestart=true
 stopsignal=QUIT
 process_name = %(program_name)s-%(process_num)s</p>
<p>A few things to note.</p>
<ol>
<li>Firstly the APP_INCLUDE should include the set of classes you intent
     to use to handle the worker jobs. Meaning something that has a
     perform action that does something, as described <a href="https://github.com/chrisboulton/php-resque#defining-jobs">here</a>.</li>
<li>You’ll notice the COUNT=1 argument being set in the resque
     environment. This is essential, if you fork more than one job using
     php-resque it’ll background both and supervisor will not be able to
     manage that process(and will continually try to spawn more processes
     till it gives up). If you wish to have multiple workers, <strong>use the
     numprocs argument</strong>.</li>
</ol>
<p>And that’s it really.</p>
<p>Happy forking!</p>
    </div>

    <footer>
        <div class="pure-g post-footer">
            <div class="pure-u-1 pure-u-md-1-2">
                <div class="pure-g poster-info">
                    <div class="pure-u-3-4">
                        <h3 class="author-name"><a href="./author/shane-dowling.html">Shane Dowling</a></h3>
                        <p class="author-description">
                        </p>
                    </div>
                </div>
            </div>



        </div>


    </footer>


</div>


</body>
</html>