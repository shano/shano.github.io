<!DOCTYPE html>
<html lang="en">
<head>
        <title>Shane Dowling : Manage background tasks with PHP-Resque and Supervisor</title>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="./theme/css/main.css" type="text/css" />
        <link href="https://shanedowling.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Shane Dowling ATOM Feed" />

        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="./css/ie.css"/>
                <script src="./js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="./css/ie6.css"/><![endif]-->

</head>

<body>
        
<header>
    <h1><a href="." id="site-title">Shane Dowling </a> :
        <a href="./manage-background-tasks-with-php-resque-and-supervisor-93d14234b703.html" id="page-title">Manage background tasks with PHP-Resque and Supervisor</a></h1>
<time datetime="2014-07-03T00:00:00+00:00">Thu 03 July 2014</time></header>
<article>
    <p><img alt="" src="images/1__DDS7CsAlPK7wTEEbPFLRAQ.jpeg"></p>
<p><a href="https://github.com/chrisboulton/php-resque">PHP-Resque</a>, the PHP equivalent to Ruby's really nice background process runner is a great way to execute long running PHP processes. <a href="http://supervisord.org/">Supervisor</a> is a python-based process control system, essentially it's a convenient way to manage custom system processes you need to handle. Combining the two to manage long running PHP jobs makes a lot of sense but it takes a little bit of work to get them talking.</p>
<p>Once you've gotten PHP-Resque <a href="https://github.com/chrisboulton/php-resque#getting-started">installed on your project</a>,
you've <a href="https://github.com/chrisboulton/php-resque#queueing-jobs">added items to your queue</a> and <a href="https://github.com/chrisboulton/php-resque#defining-jobs">written the workers to handle the background tasks</a>.
You'll need to plug PHP-Resque into supervisor. Here's a sample config
file I used to manage php resque queues within Yii projects but it
should work with anything that's using php-resque.</p>
<div class="highlight"><pre><span></span><code>[program:my_resque]
 directory=/var/www/website
 command=php vendor/chrisboulton/php-resque/bin/resque
 numprocs=2
 environment=QUEUE=&#39;myresquequeue&#39;,BLOCKING=1,COUNT=1,APP_INCLUDE=&#39;models/UsefulClasses.php&#39;
 autostart=true
 autorestart=true
 stopsignal=QUIT
 process_name = %(program_name)s-%(process_num)s
</code></pre></div>

<p>A few things to note.</p>
<ol>
<li>Firstly the APP_INCLUDE should include the set of classes you intent to use to handle the worker jobs. Meaning something that has a perform action that does something, as described <a href="https://github.com/chrisboulton/php-resque#defining-jobs">here</a>.</li>
<li>You'll notice the COUNT=1 argument being set in the resque environment. This is essential, if you fork more than one job using php-resque it'll background both and supervisor will not be able to manage that process(and will continually try to spawn more processes till it gives up). If you wish to have multiple workers, <strong>use the numprocs argument</strong>.</li>
</ol>
<p>And that's it really.</p>
<p>Happy forking!</p>
</article>

        <footer>
            <nav>
                <ul>
                    <li><a href="./pages/contact.html">Contact</a></li>
                    <li>:: <a href="./categories.html">Categories</a></li>
                </ul>
            </nav>
        </footer>

</body>
</html>